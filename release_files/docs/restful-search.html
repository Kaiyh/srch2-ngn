<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="generator" content="ReText Webpages generator 4.1.0">
<link rel="stylesheet" type="text/css" href="style.css">
<title>SRCH2: Search API</title>
</head>

<body>

<table style="width:100%;table-layout:fixed" >
<tr>
<td id="sideBarTd" style="width:25%">
<div id="sidebar"> <!-- Sidebar -->
<div id="linkpool" > <!-- Links to main pages, id=linkpool-->
<table><tbody><tr><td>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./main.html">Main page</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./install.html">Install</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./configuration.html">Configuration</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-search.html">RESTful API: Search</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-insert-update-delete.html">RESTful API: Insert/Update/Delete</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-control.html">RESTful API: Control</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./ranking.html">Ranking</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./geo.html">Geo Search</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./mongodb.html">MongoDB Search</a><br><br>
</td></tr></tbody></table>

<span ><a href="http://www.srch2.com" target="_blankt"><img style="width:100px" src="images/logo.png"></a></span>
</div> <!-- Links to main pages, id=linkpool-->

<hr>

<div id="content" > <!-- Table of content, id=content-->
<table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#ee2e24" href="#doc">Content</a></h3></div>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#overview">1. Overview</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#sampleQueries">2. Sample Queries</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#basicConcepts">3. Basic Concepts</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#fields">3.1. Fields</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#terms">3.2. Terms</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#termModifiers">3.3. Term Modifiers</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#prefixSearch">3.3.1 Prefix Search</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#fuzzySearch">3.3.2 Fuzzy Search</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#boostingTerm">3.3.3 Boosting A Term</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#proximitySearch">3.3.4 Proximity Search</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#booleanOperators">3.4. Boolean Operators</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#queryComponents">4. Query Components</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#localParams"/>5. Local Parameters</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#queryParams">6. Query Parameters</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#mainQuery">6.1. Main Query ("q")</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#filterQuery">6.2. Filter Query ("fq")</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#fieldList">6.3. Field List ("fl")</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetParams">7. Facet Query Parameters</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetEnabled">7.1. Enabling Facet</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetField">7.2. Categorical Facet</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetFieldAttribute">7.2.1 Categorical facet attribute</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetFieldRows">7.2.2 Categorical facet rows </a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetByRange">7.3. Range Facet</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetStart">7.3.1 Facet Range Start</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetEnd">7.3.2 Facet Range End</a></br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#facetGap">7.3.3 Facet Range Gap</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#searchType">8. Search Type</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#sort">9. Sort</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#orderby">10. Order by</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#start">11. Start</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#rows">12. Rows</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#fetchById">13. Fetch a Record by ID</a></br><br>

</td></tr></tbody></table>

</div>

<!-- Table of content, id=content-->

<!-- Google Tag Manager -->

<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MQK794"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MQK794');</script>

<!-- End Google Tag Manager -->

<p></div> <!-- Sidebar --></p>
</td>

<td id="docBody" style="width:70%">
</br>
<div><table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#ee2e24" href="#doc"></a></h3></div>

</td>

<p></tr></tbody></table></div></p>
<h1 id="doc" style="color:#ee2e24"><center>SRCH2 Manual: RESTful API - Search</center></h1>
<h6 id="versionInfo" style="font-size: 12px; margin-top: -20px;"><center>Version: 4.2.0, November 27, 2013</center></h6>
<h2 id="overview">1. Overview</h2>
<p>The SRCH2 engine provides a RESTful API that receives a request (query, insert/delete/update, or a control message) and gives a response in the JSON format.  This documentation describes the detail of the search API.  It begins with a set of sample queries to give an overview of the query language. It then dives into the language with an explanation of its basic concepts. Then it gives details of the structural components of a query with emphasis on their syntax specifications.  </p>
<p>Refer to <a href="restful-insert-update-delete.html">this page</a> about the insert/dete/update API and <a href="restful-control.html">this page</a> about the control API. </p>
<p>Note that each RESTful request needs to use a proper <a href="http://www.w3schools.com/tags/ref_urlencode.asp">URL encoder</a> to be converted to characters in a format that can be transmitted properly.</p>
<h2 id="sampleQueries">2. Sample queries</h2>
<p>Let us start with sample queries to give an idea of the query syntax.  For clarity, we provide both the easy to read query URL and when necessary, a curl command with the URL encoding necessary to actually send the query.  The curl command examples follow the example and is parenthesized.  URL encoding is also necessary if you choose to use a web browser.  In our example commands, we assume you have installed the srch2 server locally on port 8081.</p>
<p>Query f1 searches for all records containing the word "terminator". The result set will contain all records with the word "terminator" in a <a href="configuration.html#fields">searchable field</a>, as specified in the configuration file.</p>
<pre><code>f1) curl -i &quot;http://localhost:8081/search?q=terminator&quot;
</code></pre>

<p>Query f2 gets records with the word "terminator" in its <i>title</i>
field and the word "cameron" in its <i>director</i> field.</p>
<pre><code>f2) http://localhost:8081/search?q=title:terminator AND director:cameron
curl command with URL encoding: curl -i &quot;http://localhost:8081/search?q=title:terminator%20AND%20director:cameron&quot;
</code></pre>

<p>Query f3 filters the results based on the <i>year</i> field, i.e., the
<i>year</i> value needs to be between 1983 and 1992 (both inclusive). </p>
<pre><code>f3) http://localhost:8081/search?q=title:terminator AND director:cameron&amp;fq=year:[1983 TO 1992]
(curl -i &quot;http://localhost:8081/search?q=title:terminator%20AND%20director:cameron&amp;fq=year:%5B1983%20TO%201992%5D&quot;)
</code></pre>

<p>Query f4 filters the results based on the <i>genre</i> field.</p>
<pre><code>f4) &quot;http://localhost:8081/search?q=title:terminator AND director:cameron&amp;fq=genre:action
(curl -i &quot;http://localhost:8081/search?q=title:terminator%20AND%20director:cameron&amp;fq=genre:action&quot;)
</code></pre>

<p>Query f5 includes a filtering expression, as specified by the syntax
"boolexp$ ... $", which selects movies made after 1982.</p>
<pre><code>f5) http://localhost:8081/search?q=title:terminator AND director:cameron&amp;fq=boolexp$ year&gt;1982 $
(curl -i &quot;http://localhost:8081/search?q=title:terminator%20AND%20director:cameron&amp;fq=boolexp$%20year%3E1982%20$&quot;)
</code></pre>

<p>Query f6 sorts the results based on the year attribute in the ascending order.</p>
<pre><code>f6) curl -i &quot;http://localhost:8081/search?q=cameron&amp;sort=year&amp;orderby=asc&quot;
</code></pre>

<p>Query f7 requests the engine to return faceted information for the record's <i>genre</i> field.</p>
<pre><code>f7) curl -i &quot;http://localhost:8081/search?q=cameron&amp;facet=true&amp;facet.field=genre&quot;
</code></pre>

<p>Note: The response of a RESTful request is in the
<a href="http://www.json.org/">JSON</a> format.  The engine also supports the
<a href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> format. In order to get
the response data in JSONP, append a parameter field "callback" to the
query URL. For example:</p>
<pre><code>curl -i &quot;http://localhost:8081/search?q=terminator&amp;callback=myfunc
</code></pre>

<h2 id="basicConcepts">3. Basic Concepts</h2>
<p>Before going into queries and their components, let us first understand the basic elements of a query: <i>fields</i> and <i>terms</i>.</p>
<h3 id="fields">3.1. Fields</h3>
<p>When performing a search, we can either specify a field or use a default value. A field that is labeled as "<a href="configuration.html#fields">searchable</a>" or "<a href="configuration.html#fields">indexed</a>" can be searched with the syntax field name followed by a colon ":" and the search term. For example, suppose the data contains two fields, <i>title</i> and <i>year</i>. To find the records with "star" and "wars" in "title" field, we can use the following query:</p>
<pre><code>title:star AND wars
(title:star%20AND%20wars)
</code></pre>

<h3 id="terms">3.2. Terms</h3>
<p>There are two types of terms: "single term" and "phrase." A single term is a single word such as <i>terminator</i> or <i>cameron</i>. A phrase is a group of words surrounded by double quotes such as <i>"star wars"</i>.</p>
<h3 id="termModifiers">3.3. Term Modifiers</h3>
<p>The engine supports modifying query terms to provide a wide range of search options.</p>
<h3 id="prefixSearch">3.3.1. Prefix Search</h3>
<p>The engine supports prefix searches. For instance, the following query searches for records with a keyword that has the prefix "term*":</p>
<pre><code>q=term*
</code></pre>

<h3 id="fuzzySearch">3.3.2. Fuzzy Search</h3>
<p>The engine supports fuzzy searches based on <a href="http://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein distance</a>. The engine does a fuzzy search when the tilde symbol (<i>~</i>) is added to the end of a single term. The engine uses a customizable threshold (normalized based on the term length) to determine the edit distance used in finding the set of matching keywords. We can also specify the edit-distance threshold by explicitly giving a normalized similarity threshold (a float number between 0 and 1) for a term. Let "s" be the similarity threshold for a term given in the query. The engine will use the formula </p>
<pre><code>    floor((1-s) * length(keyword))
</code></pre>

<p>as the edit-distance threshold to do the search. If "s" is 1, we do an exact search. As example, consider the following query:</p>
<pre><code>q=spielburrg~0.8
</code></pre>

<p>The internal edit-distance threshold is floor((1-0.8) * length("spielburrg")) = floor(0.2 * 10) = 2. So the engine will find records with a keyword whose edit distance to the term "spielburrg" is at most two.</p>
<p>The engine allows each fuzzy search term to specify its own similarity value.</p>
<p>If a term does not have a similarity value, e.g.,</p>
<pre><code>spielburrg~
</code></pre>

<p>the engine will use the similarity threshold specified in the <a href="configuration.html##queryTermSimilarityThreshold">configuration file</a></p>
<h3 id="boostingTerm">3.3.3. Boosting a Term</h3>
<p>The engine provides the relevance level of matching records based on its matching terms. To boost the importance of a given term, we can use the caret symbol (<i>^</i>) with a boost number at the end of the given term. The higher the boost value, the more relevant the term will be.</p>
<p>Boosting allows control over the relevance of a record by boosting the significance of its terms. For example, if we are searching for two terms "star" and "wars", and we want the term "star" to be more relevant, we can boost it using the <i>^</i> symbol along with the boost value next to the term. We would type:</p>
<pre><code>star^4 AND wars
(star%5E4%20AND%20wars)
</code></pre>

<p>The boost value must be a positive integer, and its default value is 1.</p>
<p><em>Note:</em> we can specify all three modifiers to a single term, but the order of modifiers must always be prefix, boost, and then fuzzy. The following are valid query examples:</p>
<pre><code>1) q=sta*^4~0.6 AND wars^~0.8
   (q=sta*%5E4~0.6%20AND%20wars%5E~0.8)
2) q=star^4~0.6 AND wars^~ AND cam*
   (q=star%5E4~0.6%20AND%20wars%5E~%20AND%20cam*)
3) q=star~0.6 AND wars^5~0.8
   (q=star~0.6%20AND%20wars%5E5~0.8)
</code></pre>

<p>The following are <b>invalid</b> query examples:</p>
<pre><code>Invalid query 1) q=sta^4*
Invalid query 2) q=star~.4^3*
Invalid query 3) q=star~.6*
</code></pre>

<h3 id="proximitySearch">3.3.4. Proximity Search</h3>
<p>The engine supports finding words that are within a specified proximity. To use this feature, we need to set the <a href="configuration.html#enablePositionIndex">enablePositionIndex</a> flag in the configuration file to true.</p>
<p>To do a proximity search, we use the tilde symbol ("~") at the end of a phrase. For example, the following query searches for records with the keywords "saving" and "ryan" within 1 word (that is, either zero or one word separates them) of each other in a document:</p>
<pre><code>q=&quot;saving ryan&quot;~1
(q=%22saving%20ryan%22~1)
</code></pre>

<p>Notice that a proximity search does not support edit-distance-based fuzzy match, i.e., we do not allow typos in the keywords in the quotes.</p>
<h3 id="booleanOperators">3.4. Boolean Operators</h3>
<p>The SRCH2 engine supports three boolean operators: AND, OR, and NOT. For example:</p>
<pre><code>q=(star^4 AND wars) OR &quot;George Lucas&quot;
</code></pre>

<p>returns all records which either contain "star" and "wars" or the phrase "George Lucas". As you see Term Modifilers and Phrase Search can be used with a boolean expression. A few more examples are:</p>
<pre><code>q=(&quot;star wars&quot; AND &quot;episode 3&quot;) OR (&quot;George Lucas&quot; AND NOT &quot;Indiana Jones&quot;)

q=big AND fish AND (&quot;Tim Burton&quot; OR MacGregor~0.5)

q=pulp AND fiction AND (Tarenti~0.6* OR Travolta OR Jackson) AND NOT &quot;Jesse Jackson&quot;
</code></pre>

<h2 id="queryComponents">4. Understanding different query components</h2>
<p>The components and sub-components of a query are shown in Figure 1. The "Local Parameters" have query-related meta data specification, and the "Query Parameters" include specifications for the main query, post-processing filters, sorting, and facets.
<br>
<span ><center><img style="width:75%" src="images/Srch2-querysyntax.png" /></center></span>
<center>Figure 1: Query Components</center></p>
<h2 id="localParams">5. Local Parameters (LocalParams)</h2>
<p><i>LocalParams</i> stands for "local parameters." It provides a way to "localize" query behavior by specifying modifiers for the engine. In other words, LocalParams provides a way to add meta-data to certain argument types such as query strings.</p>
<p>To indicate a LocalParam, we prefix the target argument with curly braces containing a series of <i>key=value</i> pairs separated by a white space. So if the original query keyword is "hunt", applying LocalParams would look something like <i>{k1=v1 k2=v2 k3=v3}hunt</i>. For example, we can specify a default field in local parameters as follows:</p>
<pre><code>q={defaultSearchFields=title}hunt
(q=%7BdefaultSearchFields=title%7Dhunt)
</code></pre>

<p>The above query searches for records with the word "hunt" in the field <i>title</i>.  <i>title</i> is searched by default unless specified elsewhere in the query (see below). We can specify more than one defaultSearch field. We can also specify what logical operator to use between these fields. For example:</p>
<pre><code>q={defaultFieldOperator=AND defaultSearchFields=director,title}hunt
(q=%7BdefaultFieldOperator=AND%20defaultSearchFields=director,title%7Dhunt)
</code></pre>

<p>The above query will return records with the word "hunt" in both <i>director</i> and <i>title</i> fields. If "hunt" is present only in one of the specified defaultSearchFields, the engine will not return the record. If we want the engine to return a record with the word "hunt" present in any of the given defaultSearchFields, then we can set the value of defaultFieldOperator to "OR". The corresponding query is the following:</p>
<pre><code>q={defaultFieldOperator=OR defaultSearchFields=director,title}hunt
(q=%7BdefaultFieldOperator=OR%20defaultSearchFields=director,title%7Dhunt)
</code></pre>

<p>The following are valid localParams:</p>
<ul>
<li>
<p><a href="configuration.html#queryTermSimilarityThreshold">defaultSimilarityThreshold</a>: a number between 0 and 1. For example, "0.8" is a valid similarity threshold in fuzzy search.    </p>
</li>
<li>
<p><a href="configuration.html#fieldBoost">defaultBoostLevel</a>: a non-negative integer, e.g., 2.</p>
</li>
<li>
<p><a href="configuration.html#queryTermType">defaultPrefixComplete</a>: 'PREFIX' or 'COMPLETE' (without quotes, case sensitive), indicating whether the term is treated as a prefix or a complete term.</p>
</li>
<li>
<p>defaultSearchFields: default fields to search in, e.g., <i>title</i>. We can specify more than one field by using comma (',') to separate them, e.g., 'defaultSearchFields=title,director,year' (without quotes).</p>
</li>
<li>
<p>defaultFieldOperator : 'AND' or 'OR' (without quotes). It's a boolean operator to be applied between the default search fields specified by comma-separated fields.</p>
</li>
</ul>
<h2 id="queryParams">6. Query Parameters</h2>
<h3 id="mainQuery">6.1. q: Main query parameter</h3>
<p>A search over a searchable field is denoted by its name and the search term separated with a colon ":". For example, consider the query below:</p>
<pre><code>q=title:wind
</code></pre>

<p>This searches for the keyword "wind" in the field <i>title</i> of a record. If no field is provided, but local parameter defaultSearchFields described above is provided, the fields specified by that parameter will be searched.  If neither parameter was provided, the engine will search on the <a href="configuration.html#fields">'indexed' field(s)</a> as specified in the <a href="example-demo/srch2-config.xml">configuration file</a>. For example,</p>
<pre><code>q=wind
</code></pre>

<p>The above query searches for the keyword "wind" in all the searchable fields as specified in the configuration file.<br></p>
<p><em>Note:</em> all the field names used in "q" must have their "searchable" property or "indexed" property set to true in the configuration file.</p>
<h3 id="filterQuery">6.2. fq: Filter-query parameter</h3>
<p>This parameter is used to specify a filter restricting the set of records returned, without influencing their scores. In the example below, only records having year equal to 2012 will return.</p>
<pre><code>fq=year:2012
</code></pre>

<p>A range query allows us to match records whose field value is between a specified lower bound and upper bound (both inclusive). For example:</p>
<pre><code>year:[2010 TO 2012]
(year:%5B2010%20TO%202012%5D)
</code></pre>

<p>The above query finds records whose <i>year</i> of release field has a value between 2010 and 2012 (both inclusive). <br></p>
<p>Please note: range queries are not just for numerical fields. We could also use range queries on non-numerical fields. Example:</p>
<pre><code>genre:[comedy TO drama]
(genre:%5Bcomedy TO drama%5D)
</code></pre>

<p>This will find all records whose <i>genre</i> value is alphabetically between "comedy" and "drama" (both inclusive).</p>
<p><em>Note:</em> the engine supports only one kind of boolean operator (OR or AND) between all the filter terms. The following are examples of valid arguments:</p>
<pre><code>1) fq=id:[1000 TO *] AND genre:drama AND year:[* TO 1975]
   (fq=id:%5B1000%20TO%20*%5D%20AND%20genre:drama%20AND%20year:%5B*%20TO%202000%5D)
2) fq=id:[1000 TO *] OR genre:drama OR year:[* TO 1975]
   (fq=id:%5B1000%20TO%20*%5D%20OR%20genre:drama%20OR%20year:%5B*%20TO%201975%5D)
</code></pre>

<p>The first query returns the records with an <i>id</i> greater than or equal to 1000, a <i>genre</i> of drama, and <i>year</i> greater than or equal to 1975.</p>
<p>The engine supports specifying boolean expressions only as filters. These expressions must be surrounded by "boolexp$" and "$".</p>
<pre><code>fq=boolexp$log(year) + 5 &gt; log(2003)$
(fq=boolexp%24log%28year%29%20%2B%205%20%3E%20log%282003%29%24)
</code></pre>

<p>Please note: for the predicate "boolexp$ numOfReviews * 5 + numOfLikes * 2 &gt; 940$", the engine will evaluate the boolean expression between the two '$' signs, which in this case is "numOfReviews * 5 + numOfLikes * 2 &gt; 940". Here <i>numOfReviews</i> and <i>numOfLikes</i> are two fields defined in the schema.</p>
<p>In filter query terms, we can use the "-" operator before a field:term binding to tell the engine to exclude the records from the results that match the given binding criterion. For example:</p>
<pre><code>fq=-year:[1975 TO *]
(fq=-year:%5B1975%20TO%20*%5D)
</code></pre>

<p>The above filter query will find records for movies released before 1975.</p>
<p>Please note: the attributes used in "fq" must have the "refining" property set to true in the configuration file. The SRCH2 movie demo does not normally configure refining for all fields used as examples in this document. Also, only the attributes of type INT and FLOAT can be used in the "boolexp$$" block.</p>
<h2 id="facetParams">7. Facet Query Params</h2>
<h3 id="facetEnabled">7.1. facet</h3>
<p>This value is "true", "false" or "only", indicating whether we want to enable faceting. To turn faceting on, we need to include the following</p>
<pre><code>facet=true
</code></pre>

<p>Setting fact to "only" will make the engine only return facet results. This option helps the user when he only needs facet results and wants to avoid network communication overhead of sending back the results.</p>
<p>Please note: facet must also be enabled from the configuration file by setting the
 <a href="configuration.html##facetEnabled">"facetEnabled"</a> tag to true.</p>
<h3 id="facetField">7.2. Facet by Category</h3>
<h3 id="facetFieldAttribute">7.2.1 facet.field</h3>
<p>This parameter specifies a field to be treated as a categorical facet. It finds the number of distinct values in the specified field and returns the number of records that match each value. This parameter can be specified multiple times to indicate multiple facet fields.</p>
<pre><code>facet=true&amp;facet.field=year&amp;facet.field=genre
</code></pre>

<p>This query specifies <i>"facet=true"</i> to turn on faceting. The parameters <i>facet.field</i> request that the engine include in the response the facets for the fields <i>year</i> and <i>genre</i>.</p>
<h3 id="facetFieldRows">7.2.2 f.<i>category</i>.rows</h3>
<p>This is the maximum number of categories with maximal frequencies to be returned. All categories are returned by default. Example: adding the following parameter to the query will tell the engine to return the top 10 most popular genres.</p>
<pre><code>f.year.rows=10
</code></pre>

<p>Note the different query parameter name of <i>f</i> instead of <i>field</i> for backward compatibility to Solr.</p>
<h3 id="facetByRange">7.3. Facet by Range</h3>
<h3 id="facetRange">7.3.1 facet.range</h3>
<p>This parameter can be used to specify a field that should be treated as a range facet. It allows us to specify fields for which only facets within a specified range will be included. Example:</p>
<pre><code>facet.range=year
</code></pre>

<p>The response of the above query includes facet information for the <i>year</i> field. <br></p>
<p>Please note: the <a href="configuration.html#facetFields">configuration file</a> should define the default <i>facet.start</i>, <i>facet.end</i>, and <i>facet.gap</i> values.</p>
<h3 id="facetStart">7.3.2. f.<i>category</i>.range.start</h3>
<p>This is the minimum value (inclusive) of the range. Example:</p>
<pre><code>f.year.facet.start=1995
</code></pre>

<p>The above query defines the lower bounds of the facet range for the <i>year</i> field.</p>
<h3 id="facetEnd">7.3.3. f.<i>category</i>.range.end</h3>
<p>It is the upper bound (exclusive) of the range. Example:</p>
<pre><code>f.year.facet.end=2020
</code></pre>

<p>The above query defines the upper bounds of the facet range for the <i>year</i> field.</p>
<h3 id="facetGap">7.3.4. f.<i>category</i>.range.gap</h3>
<p>This parameter determines the size of each range by which to group the facet values starting from the minimum value. Example:</p>
<pre><code>f.year.facet.gap=5
</code></pre>

<p>The above query defines the gap between each consecutive faceted value of the facet range for the <i>year</i> field.</p>
<p>Note that all start, end, and gap values, if given in the query, will override the corresponding values in the configuration file.</p>
<p><em>Note:</em> if the expected number of results of a query is greater than 10K, facet results are made based on the best 2000 results.</p>
<h2 id="searchType">8. searchType</h2>
<p>The engine offers three different strategies for searching records:</p>
<ul>
<li>topK: The results will be sorted descending by their score. This score is calculated for each record. This approach has a high performance, but does not support facet and sort operations. <br></li>
<li>getAll: Use this strategy if facets and sort query parameters are needed.</li>
<li>geo: Use of a location-based search. Sort and facets are supported. <br></li>
</ul>
<p>The following are examples of using searchType:</p>
<pre><code>1) searchType=topK
2) searchType=getAll
3) searchType=geo
4) searchType=getAll&amp;sort=director
</code></pre>

<p><em>Note:</em> if searchType is not included in the query, it is set to topK by default. However, if any facet or sort parameter is included in the query, the search type will be getAll.
<em>Note:</em> If the searchType is 'getAll' and if the expected number of results is more than 10,000, the engine will return the top 2000 results based on the ranking score.</p>
<h2 id="sort">9. sort</h2>
<p>The engine's default behavior is to sort the results using a descending order by the overall score of each record. The user can specify sorting by other fields. For example:</p>
<pre><code>sort=director,year,title
</code></pre>

<p><em>Note:</em> if a sort request is included in the query, the returned records' scores are still those calculated scores by the engine, but the order of the results corresponds to the user specification.
<em>Note:</em> if the expected number of results of a query is greater than 10K, the ranking function is used to find the best 2000 results, which are then sorted based on the sort parameter and returned.</p>
<h2 id="orderby">10. orderby</h2>
<p>It specifies the order in which the result set should be sorted. Its default value is "desc" (descending). This order is valid for all the fields specified in the sort parameter.</p>
<pre><code>orderby=asc
</code></pre>

<p><em>Note:</em> the order specified in the <i>orderby</i> parameter will be applied to all the fields mentioned in the sort parameter. Currently, specifying different <i>orderby</i> values for different fields is not supported.</p>
<h2 id="start">11. start</h2>
<p>It is the offset in the complete result set of the query, where the set of returned records should begin. The default value is 0.</p>
<pre><code>start=10
</code></pre>

<h2 id="rows">12. rows</h2>
<p>It indicates the number of records to return from the complete result set. Its default value is 0.</p>
<pre><code>rows=7
</code></pre>

<p>This parameter and <i>start</i> can be used to implement pagination.</p>
<h2 id="fetchById">13. Fetch a Record by ID</h2>
<p>The SRCH2 engine provides an API that allows the user to fetch a record by giving its primary key value.  An example of such a request is:</p>
<pre><code>curl -i &quot;http://localhost:8081/search?docid=929&quot;
</code></pre>

<p>which returns the record with "929" (text) as its primary key value. Note that the primary key is defined by the tag "uniqueKey" under the "schema" tag.</p>

</table>
<hr>

<link rel="stylesheet" type="text/css" href="documentation.css">

<script type="text/javascript" src="setSizes.js"></script>
<script>

setSizes();
window.onresize = setSizes
</script>

<script language="javascript"> 
months = ['January', 'Febraury', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; 
var theDate = new Date(document.lastModified); 
theDate.setHours(theDate.getHours() - 7)
with (theDate) { 
document.write("<div align=right>Last Updated: " + months[getMonth()] + ' ' + getDate()  +', ' + getFullYear() +', ' + getHours() + ':' + ("0" + getMinutes()).slice(-2) + " PST  </div>") 
} 
</script>

</body>
</html>
