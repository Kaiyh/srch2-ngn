<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="generator" content="ReText Webpages generator 4.0.1">
<link rel="stylesheet" type="text/css" href="style.css">
<title>SRCH2: Control API</title>
</head>

<body>

<table style="width:100%;table-layout:fixed" >

<tr>
<td id="sideBarTd" style="width:15%">
<div id="sidebar"> <!-- Sidebar -->
<div id="linkpool" > <!-- Links to main pages, id=linkpool-->
<table><tbody><tr><td>
<a href="http://www.srch2.com" target="_blankt"><img style="height:24px" src="images/logo.png" align="center"></a><br><br>
<div style="align:center; font-size: 12px">Verion 4.3.4, 07/21/2014</div><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./main.html">Overview</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./install.html">Install</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./configuration.html">Configuration</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-search.html">Search</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-insert-update-delete.html">Insert/Update/Delete</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./restful-control.html">Control Messages</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./ranking.html">Ranking</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./geo.html">Geo Search</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="./mongodb.html">MongoDB Search</a><br><br>
</td></tr></tbody></table>

</div> <!-- Links to main pages, id=linkpool-->

<hr id="toc_ruler">

<div id="content" > <!-- Table of content, id=content-->
<table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#ee2e24" href="#doc">Content</a></h3></div>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#system-status">1. Retrieving System Status</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#serialize-indexes">2. Serializing Indexes to Disk</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#serialize-records">3. Serializing Records to Disk</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#reset-log">4. Resetting Log File</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#shutdown">5. Shutdown</a><br><br>

</td></tr></tbody></table>

</div>

<!-- Table of content, id=content-->

<!-- Google Tag Manager -->

<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MQK794"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MQK794');</script>

<!-- End Google Tag Manager -->

<p></div> <!-- Sidebar --></p>
</td>

<td id="docBody" style="width:70%">
</br>
<div><table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#ee2e24" href="#doc"></a></h3></div>

</td>

<p></tr></tbody></table></div></p>
<h1 id="doc" style="color:#ee2e24"><center>SRCH2 RESTful API - Control Messages</center></h1>
<p>The SRCH2 engine supports certain control messages through its RESTful API.  Here we explain how to use the maessages
to manage the engine.  Each RESTful request needs to use a proper <a href="http://www.w3schools.com/tags/ref_urlencode.asp">URL encoder</a> to be converted to characters in a format that can be transmitted properly.</p>
<h2 id="system-status">1. Retrieving System Status</h2>
<p>This request returns the information about the system status. The response body will contain a JSON map with these fields:</p>
<ul>
<li><b>search_requests</b>: the number of queries received by the server;</li>
<li><b>write_requests</b>: number of insert/delete/update requests received by the server;</li>
<li><b>docs_in_index</b>: number of documents in the indexes;</li>
<li><b>last_merge</b>: last time (UTC time) the inserted/deleted/updated documents are merged into the indexes;</li>
<li><b>last_merge_time</b>: the time spent to merge the inserted/deleted documents into the indexes;</li>
<li><b>version</b>: version of this engine.</li>
</ul>
<p>Here is an example query: </p>
<pre><code>$ curl -i &quot;http://localhost:8081/info&quot;
</code></pre>

<p>Here is an example response:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Content-Length: 138
Date: Thu, 19 Sep 2013 18:52:52 GMT

{&quot;engine_status&quot;:{&quot;search_requests&quot;:&quot;0&quot;,&quot;write_requests&quot;:&quot;100&quot;,&quot;docs_in_index&quot;:&quot;100&quot;,&quot;last_merge&quot;:&quot;02/10/14 23:11:21&quot;,&quot;last_merge_time&quot;:&quot;0&quot;,&quot;doc_count&quot;:&quot;100&quot;}, &quot;version&quot;:&quot;4.2.0&quot;}
</code></pre>

<h2 id="serialize-indexes">2. Serializing Indexes to Disk</h2>
<p>This request tells the engine to serialize the indexes, with all the changes made so far, to files in the path specified by the parameter "dataDir" in the <a href="example-demo/srch2-config.xml">configuration file</a>. Here is an example: </p>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/save&quot; -X PUT
</code></pre>

<h2 id="serialize-records">3. Serializing Records to Disk</h2>
<p>This request tells the engine to serialize the records, with all the changes made so far, to a file in the path specified by the parameter "dataDir" in the configuration file. Deleted records will be ignored. The request can specify the file name as well, using a variable called "exported_data_file". Here is an example: </p>
<pre><code>$ curl -i &quot;http://localhost:8081/export?exported_data_file=mydata.json&quot; -X PUT
</code></pre>

<p>The engine will store the records in the file "mydata.json" in the folder specified by the parameter "dataDir".</p>
<h2 id="reset-log">4. Reseting Log File</h2>
<p>This API is used by a third-party tool such as
<a href="http://linuxcommand.org/man_pages/logrotate8.html">logrotate</a> to manage the log file. Suppose the "logrotate" tool has renamed the log file "srch2-log.txt" to another file "srch2-log.txt.1".
The tool also has re-created a file with the original name "srch2-log.txt".  The SRCH2 engine is still writing log messages to the file "srch2-log.txt.1".
Now "logrotate" sends the following message:</p>
<pre><code>$ curl -i &quot;http://localhost:8081/resetLogger&quot; -X PUT
</code></pre>

<p>It tells the SRCH2 engine to reset its log-file handle to continue using the original file name  "srch2-log.txt". In this way, the old log messages have been moved to the file ""srch2-log.txt.1", which can be managed by the "logrotate" tool. Here is an example configuration file for "lograte":</p>
<pre><code>&quot;/home/joe/srch2/logs/srch2-log.txt&quot; {
    weekly
    missingok
    rotate 52
    notifempty
    sharedscripts
    postrotate
            curl -i &quot;http://localhost:8081/resetLogger&quot; -X PUT
    endscript
    prerotate
    endscript
}
</code></pre>

<h2 id="shutdown">5. Shutdown the server</h2>
<p>The client can send a shutdown message to let the server stop gracefully. The request should be sent to the "/_all/shutdown" path by a "PUT" method.  Here is an example query: </p>
<pre><code>$ curl -i &quot;http://localhost:8081/_all/shutdown&quot; -X PUT
</code></pre>

</table>
<hr>

<link rel="stylesheet" type="text/css" href="documentation.css">

<script type="text/javascript" src="setSizes.js"></script>
<script>

setSizes();
window.onresize = setSizes
</script>

<script language="javascript"> 
months = ['January', 'Febraury', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; 
var theDate = new Date(document.lastModified); 
theDate.setHours(theDate.getHours() - 7)
with (theDate) { 
document.write("<div align=right>Last Updated: " + months[getMonth()] + ' ' + getDate()  +', ' + getFullYear() +', ' + getHours() + ':' + ("0" + getMinutes()).slice(-2) + " PST  </div>") 
} 
</script>

</body>
</html>
