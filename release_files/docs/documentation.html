<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="generator" content="ReText 4.0.1">
<title>documentation</title>
</head>
<body>
<p><link rel="stylesheet" href="highlight/styles/default.css">
<script src="highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="shortcut icon" href="images/tab_icon.png" ></p>
<script>
    function display(value){
        //<p id='InstantTypeForward'><div style="width:500px" id="bigBox"><div style="float:left;  max-width:200px;"><p id="InstantTypeForward_exp" style="face:arial; font-size:15">Is your instant search instant? If not, it's costing you. Each keystroke adds strain to your servers. Slow or low relevance means people don't find what they are looking for. Inefficient search is expensive.</p></div><div style="float:right; vertical-align:middle" id="InstantTypeForward_img"><img src="./images/InstantTypeForward.png"></div></div></p>
        var TEXT = document.getElementById(value + "_text").innerHTML;
        html = "";
        html += "<div style='width:500px' id='bigBox'>"
        html += "<div style='float:left;  max-width:200px;'><p id='InstantTypeForward_exp' style='face:arial; font-size:15'>"
        html += TEXT;       
        html += "</p></div>";
        html += "<div style='float:right; vertical-align:middle' id='InstantTypeForward_img'>";
        html += "<img src='images/" + value + ".png' ></div>";
        html += "</div>";
        document.getElementById(value).innerHTML = html;

        html = "";
        html += "<span onclick=hide('"+value+"');> [hide]</span>";
        document.getElementById(value+"_main").innerHTML = html;
    }

    function hide(value){
        document.getElementById(value).innerHTML = "";
        html = "<span onclick=display('"+value+"');> [show]</span>";
        document.getElementById(value + "_main").innerHTML = html;
    }
</script>

<p><body onload="display('InstantTypeForward');">
<font face="Arial"></p>
<p id="InstantTypeForward_text" hidden>Is your instant search instant? If not, it's costing you. Each keystroke adds strain to your servers. Slow or low relevance means people don't find what they are looking for. Inefficient search is expensive.</p>

<p id="fuzzySearch_text" hidden>Ever make a typo when you've searched? Ever guess how to spell a name? We can help you. Fuzzy techniques find what you want, even if you make a mistake.</p>

<p id="geoSearch_text" hidden>SRCH2's patented indexing methods enable to rapidly find locations as you type.</p>

<p id="fullTextSearch_text" hidden>Try this. Search for "paint products" at a major home improvement retailer. No instant recommendations. Why? Relevance requires a full-text search. Other Search tools don't do this. They rely on search patterns, rather than a true search of every word in your database.</p>

<p id="realTimeUpdates_text" hidden>How long does it take after a database is updated before those new items appear in search results? How about no time at all?</p>

<p id="customRankings_text" hidden>Results can be configured so that you show what's important. Prioritize by conversion, or inventory, or timeliness. It's your search, so you choose.</p>

<table><tr>

<td style="width:14%"> 
<div id="content">
<table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#880000" href="#doc">Documentation</a></h3></div>

&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#install">Install</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#restfulapi"/>RESTful API</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#geo">Geo Search</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#ranking">Ranking</a></br><br>
</td></tr></tbody></table>

<p><span ><a  href="http://www.srch2.com" target="_blankt"><img  style="width:100px" src="images/logo.png" /></a></span></br></br>
</div>
</td>
<td style="width:86%"></p>
<h1 id="doc" style="color:#880000">SRCH2 Engine Documentation</h1>
<h4>[Note: SRCH2 runs on 64-bit Linux with a kernel version &gt;= 2.6.]</h4>
<h3 id="intro">Introduction</h3>
<blockquote>
<p>We’re different. Without custom work, without coding, we offer:</p>
<ul>
<li>
<p><p style="display: inline">Instant Type-Forward Results<span id="InstantTypeForward_main" style="display: inline; cursor: pointer; color:#3366FF;"> <span  onclick="hide('InstantTypeForward');">[hide]</span></span></p>
      <p id='InstantTypeForward'></p></p>
</li>
<li>
<p><p style="display: inline">Error Fixing with Fuzzy Search<span id="fuzzySearch_main" style="display: inline; cursor: pointer; color:#3366FF;"> <span onclick="display('fuzzySearch');"> [show]</span></span></p>
      <p id='fuzzySearch'></p></p>
</li>
<li>
<p><p style="display: inline">Rapid Geo Search<span id="geoSearch_main" style="display: inline; cursor: pointer; color:#3366FF;"><span onclick="display('geoSearch');" > [show]</span></span></p>
      <p id='geoSearch'></p></p>
</li>
<li>
<p><p style="display: inline">Full Text Indexes of Every Word, in Every Record<span id="fullTextSearch_main" style="display: inline; cursor: pointer; color:#3366FF;"><span onclick="display('fullTextSearch');"> [show]</span></span></p>
      <p id='fullTextSearch'></p></p>
</li>
<li>
<p><p style="display: inline">Real-Time Updates, No Locks<span id="realTimeUpdates_main" style="display: inline; cursor: pointer; color:#3366FF;"><span  onclick="display('realTimeUpdates');"> [show]</span></span></p>
      <p id='realTimeUpdates'></p></p>
</li>
<li>
<p><p style="display: inline">All in massive scale, all at once.<span id="customRankings_main" style="display: inline; cursor: pointer; color:#3366FF;"><span onclick="display('customRankings');"> [show]</span></span></p>
      <p id='customRankings'></p></p>
</li>
</ul>
<p>Getting started is easy.</p>
<p>SRCH2 provides a RESTful API, which can be used easily to do search queries, insert new documents, and delete existing documents. These clean configuration capabilities make getting started a snap.</p>
<p>You decide! We let you use the combination of rich search features you care about most. Easy configuration is the whole point. Decide how many errors you want to tolerate, or configure your ranking prioritization. For example, news and social sites might put the most recent records on top, while e-commerce sites might favor profitability, or relevance, or inventory in stock.</p>
<p>How to Set Up:
  This document illustrates how to set up a simple SRCH2 implementation. We’ll take you through all the basic steps required to download SRCH2, index your database in standard JSON format, configure search features, and run your search server. SRCH2 runs on a Linux Ubuntu server. Please keep in mind that SRCH2 is designed to be highly configurable, so while this will get you started, we hope you tune it to your specific needs and use cases. An online demo based on these instructions is available at <a href="http://example.srch2.com" style="text-decoration:none;" target="_blank">http://example.srch2.com</a>. Enjoy!
</br></p>
</blockquote>
<h2 id="install">Install</h2>
<p><div id="indexTable"><table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#880000" href="#doc">Contents</a></h3></div></p>
<p>&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#serverConfig">Configure and Run the Search Server</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#wsgi"/>Install Apache and mod_wsgi</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#UI">Design a Simple User Interface</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#ranking">Ranking</a></br><br>
</td></tr></tbody></table></div></p>
<h3 id="serverConfig">Configure and Run the Search Server</h3>
<blockquote>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Download the SRCH2 Engine from <a href="http://www.srch2.com/files/srch2-engine-v3.0.tgz" style="text-decoration:none">here</a>. Then extract it and put all of the files where you want to have the engine. There are four files there as below:</p>
<ul>
<li><em>srch2-engine</em> (Binary file of the engine)</li>
<li><em>conf.ini</em> (The configuration file)</li>
<li><em>readme.txt</em> </li>
<li><em>sample-data.json</em> (It is a sample data having <a href="http://www.json.org/" style="text-decoration:none" target="_blank">JSON</a> format to test the engine with)</li>
</ul>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Obtain a license key from SRCH2 by emailing <em>contact (at) srch2 (dot) com</em>. SRCH2 will send you a temporary license key file which has an expiration date. Store the key file locally, such as <em>“srch2_license_key.txt”</em>.</p>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open the <em>conf.ini</em> file that you downloaded  and set the <em>“license-file”</em> option to the path of the key, such as</p>
</blockquote>
<pre><code class="python">license-file=/path/to/the/srch2_license_key.txt
</code></pre>

<blockquote>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open the <em>conf.ini</em> file and set the <em>“data-file-path”</em> option to the path of the data. For this example it is already set, you can find it like</p>
</blockquote>
<pre><code class="python">data-file-path=sample-data.json
</code></pre>

<blockquote>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;(Optional) The engine can be optionally configured to support geo index. So you have two options:</p>
<ul>
<li>
<p>Keyword Search (option 1)</p>
</li>
<li>
<p>Keyword + Geo OR Geo only (option 2)</p>
</li>
</ul>
<p><em>Trade-offs:</em> Keyword search (Option 1) alone is very powerful, and analogous to many widely-used full-text search solutions. It is very fast. Keyword+Geo (Option 2) offers a new hybrid indexing approach. You need to pick one option at the start, because SRCH2 will index your data differently depending on your choice (For Keyword+Geo, the lat and lng need to be a float type in the json objects in the data file. See the sample-data.json in the package for an example). To get more information about Geo search, go to the end of this documentation. </p>
<p><strong>Step 6:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Now it is time to run the engine. Open a terminal and go to the directory of the engine that you have already downloaded</p>
</blockquote>
<pre><code class="python">&gt; cd path/to/the/engine/directory
</code></pre>

<blockquote>
<p>Run the engine now.</p>
</blockquote>
<pre><code class="python">&gt; ./srch2-engine --config-file=conf.ini
</code></pre>

<blockquote>
<p><em>conf.ini</em> is the config file and here we are passing it to the engine. Wait until the engine finishes the index construction and is ready to serve queries. </p>
<p>You should see 
<center>
  <img alt="Engine is running" src="./images/engine_running.png">
</center></p>
<p><strong>Step 7:</strong>&nbsp;&nbsp;&nbsp;&nbsp;(Optional) If you don't have <em>curl</em> installed on your machine, you need to install it to test the engine through terminal</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install curl
</code></pre>

<blockquote>
<p><strong>Step 8:</strong>&nbsp;&nbsp;&nbsp;&nbsp;To test the engine, open a new terminal use the following command. For example you want to search for the keyword <em>“properties”</em> you should write</p>
</blockquote>
<pre><code class="python">&gt; curl -i  http://localhost:8081/search?q=properties
</code></pre>

<blockquote>
<p>This query is doing a search for a "keyword search" index. Now you should see the results as following</p>
</blockquote>
<p><center></p>
<blockquote>
<p><img alt="Engine is running" src="./images/results.png">
</center>
</br></p>
</blockquote>
<h3 id="wsgi">Install Apache and mod_wsgi</h3>
<blockquote>
<p>This section shows how to install apache and the mod_wsgi on Ubuntu and CentOs. If you have already installed the Apache and mod_wsgi on your machine, you can skip this part. </p>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install Apache2</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install apache2
</code></pre>

<blockquote>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install the mod_wsgi</p>
</blockquote>
<pre><code class="python">&gt; sudo aptitude install libapache2-mod-wsgi
</code></pre>

<blockquote>
<p>WSGI is a Web Server Gateway Interface and is for communications between web servers and web applications for Python programming language.</p>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;<em>mod_wsgi</em> needs to have python installed on your machine. If you don't have python, install it using the following command, else skip this step.</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install python
</code></pre>

<blockquote>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install simplejson python package, which is an extensible JSON encoder and decoder</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install python-setuptools
</code></pre>

<pre><code class="python">&gt; sudo easy_install simplejson
</code></pre>

<blockquote>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;So far you have installed Apache, mod_wsgi and python. A WSGI script will forward the request from Apache to the SRCH2 engine, which is running on the same machine, and will get the search results and sends them back. A simple WSGI script is as following</p>
</blockquote>
<pre><code>import cgi
import simplejson
import urllib2

def application(environ, start_response):

        #Parse the request
        d = cgi.parse_qs(environ['QUERY_STRING'])
        query = d.get('q', [''])[0]
        callback = d.get('callback', [''])[0]
        query = &quot;+&quot;.join(query.split(&quot; &quot;))

        #Forward the request to the engine and get the results
        query_url = &quot;http://127.0.0.1:8081/search?q=&quot; + query + &quot;&amp;fuzzy=1&quot;
        request = urllib2.Request(query_url)
        resp = urllib2.urlopen(request).read()

        #Configure response content and wrap the output into the &quot;callback&quot;
        status = '200 OK'

        output = callback+'('+resp+');'
        response_headers = [('Content-type', 'text/plain'),
                        ('Content-Length', str(len(output)))]
        start_response(status, response_headers)
        return [output]
</code></pre>

<blockquote>
<p>This script makes the query and sends it to the engine. You can see the query in "query_url" variable. If you want to do a fuzzy search, you should keep "&amp;fuzzy=1" and if you don't want to do it, you should remove the part "+ &amp;fuzzy=1" from the end of query_url</p>
</blockquote>
<h3 id="UI">Design a Simple User Interface</h3>
<blockquote>
<p>This part will show how to design a simple user interface and connect it to the engine. The overall process is first, you need to have a html page that has an input box for the search keywords. Then you have to send the query to the search engine using Ajax. Then you have to get the respond and show the results. </p>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Design a html page for searching and then connect it to your engine. The simplest way is to have a <em>input box</em> to write the keywords in it. Here is a simple html page. To download this file, right click on <a href="./example-demo/index.html" style="text-decoration:none" target="_blank">index.html</a> and click on "Save Link as".</p>
</blockquote>
<pre><code>&lt;!--DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;--&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;SRCH2&lt;/title&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;acunit.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;srch2.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;jquery-1.7.1.min.js&quot;&gt;&lt;/script&gt;
&lt;link rel='stylesheet' href='acunit.css' type='text/css' /&gt;

&lt;/head&gt;
&lt;body onload=&quot;document.getElementById('input').focus();&quot;&gt;
&lt;center&gt;&lt;div&gt;&lt;h1&gt;SRCH2 Engine&lt;/h1&gt;&lt;/div&gt;
&lt;div&gt;&lt;table&gt;
        &lt;tr &gt;
                &lt;td colspan=3&gt;
                        &lt;input type='text' style=&quot;height:40px; width:400px; font-size:25px;&quot; class='inputTextfield' autocomplete='off' id='input'&gt;
                        &lt;script&gt;
                        var isFuzzy=true;//set the query is fuzzy or not.
                        var isDropDownList=false; //show the results with DropDownList or not
                        var attibuteArray = new Array(&quot;name&quot;); //the attributes that you want to show
                        //if you show the results on the page, please give the div id, like  div id =&quot;results&quot;
                        var InfoShow=new InformtionShow(isDropDownList,attibuteArray,&quot;results&quot;);
                        //set you search engine application test, like &quot;apptest&quot;
                        var InfoUrl=new InformtionUrl(isFuzzy,&quot;apptest&quot;);

                        var ac = new ACUnit(&quot;input&quot;, &quot;acunit&quot;, &quot;item1&quot;,&quot;item2&quot;, &quot;sitem&quot;, 
                        function (value) {//this is onchange event
                         check(value,InfoShow,InfoUrl);
                         var regex=/\+|\s/gi;
                        if(value.replace(regex, &quot;&quot;).length &lt; 3) {
                         ac.showList(false);//clear the dropdownlist

                        }
                        }, function (current,value) //this is the onclick event.
                        {
                            if(current &gt;= 0)
                            {
                                if(current &lt; data.length)
                                {
                                    window.open(&quot;http://stackoverflow.com/questions/&quot;+data[current].record.id)
                                }
                                else
                                {
                                    window.open(&quot;http://stackoverflow.com/search?q=&quot;+document.getElementById(&quot;input&quot;).value)
                                }       
                            }
                            ac.showList(false);
                        });
                ac.input.focus();        &lt;/script&gt;
                &lt;/td&gt;
        &lt;/tr&gt;
&lt;/table&gt;&lt;/div&gt;
&lt;/center&gt;&lt;div id='results'&gt;&lt;/div&gt;&lt;hr&gt;
&lt;center&gt;Powered by SRCH2&lt;/center&gt;
&lt;style type=&quot;text/css&quot;&gt;
span.fuzzy {
        color: #ff00ff;
        font-weight: bold;
}
span.exact {
        color: red;
        font-weight: bold;
}&lt;/style&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>

<blockquote>
<p>Notes:</p>
<blockquote>
<ol>
<li>When someone types in the input box, it calls a JavaScript function called <code>check()</code>, which gets the search keywords and calls other functions to do the Ajax and show the results. To check it look at "onkeyup='check(this.value)'" inside the code. 'this.value' is the search keyword that are typed so far.</li>
<li>index.html is using two other files for showing the results in a drop-down format. To download these files, right click on the following links and click on "Save Link as": <a href="./example-demo/acunit.js" style="text-decoration:none" target="_blank">acunit.js</a> and <a href="./example-demo/acunit.css" style="text-decoration:none" target="_blank">acunit.css</a></li>
</ol>
</blockquote>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;“srch2.js” has a function named <code>check()</code> which will be called whenever you type a character to search. Then it calls another function named <code>query()</code> to construct the query and uses Ajax to send it to the server. Then it shows the results by calling a function named <code>display()</code>. There are some other functions that are used by the mentioned functions and For more details about this functions, read the comments provided in the code. To download this file, right click on <a href="./example-demo/srch2.js" style="text-decoration:none" target="_blank">srch2.js</a> and click on "Save Link as".</p>
</blockquote>
<pre><code>var pending = false;
var old_q = &quot;&quot;;
var busy=false;
var data;
var response;
var busy = false;
var pending = false;
var page = 0;
var m = 20;
var filter = 1;
var inf = 0;

/*
 * the information of  search url
 */
function InformtionUrl(isFuzzy,testAppName)
{
    this.isFuzzy=isFuzzy;
    this.testAppName=testAppName;// search engine application name
}

/*
 * the information of showing
 */
function InformtionShow(isDropDownList,attibuteArray,resultDivId)
{
    this.isDropDownList=isDropDownList;
    this.attibuteArray=attibuteArray;
    this.resultDivId=resultDivId;
}

/*
   When someone types in the input box, it calls a JavaScript function called 
 *  check(), 
 *    | if the keyword is ok, do the query,
 *  query() 
 *    | contrust the query and do the Ajax to get the json result
 *  display()
 *    | show the results
 *  prepareRegex()
 *   | prepare the Regex with edit-distance ed for matching prefix keys
 *  highlight()
 *   | highlight the matching prefix keys and show the results  
 */

//check whether query value is null or  its length &gt;= 3
function check(value,InfoShow,InfoUrl) {
    var regex=/\+|\s/gi;

    if(value.replace(regex, &quot;&quot;).length &gt;= 3) {
        if(busy)pending = true;
        else query(value,InfoShow,InfoUrl);
    }
    else
    {
        busy = false;
        document.getElementById(InfoShow.resultDivId).innerHTML = &quot;&quot;;
    }
}

function query(value,InfoShow,InfoUrl) {

    if(value.length &gt;= 2){
        var regex=/\+/gi;
        value = value.replace(regex,&quot;&quot;);
        value = value.replace(/ +(?= )/g,'');
        var valuestmp = value.split(' ');
        var values = valuestmp;
        for (var i = 0; i &lt; valuestmp.length; i++ )
        {
            if (valuestmp[i] == &quot;&quot;)
            values.splice(i,i+1);
        }
        //set the url for query
        var url = &quot;http://localhost/&quot;;
        url+=InfoUrl.testAppName;
        url+=&quot;?q=&quot;;
        var first = 1;
        var q = &quot;&quot;;
        for(var i = 0; i &lt; values.length; i++) {
            if(values[i]!=''){
            if(!first)q += &quot;+&quot;;//use &quot;+&quot; to  the keywords
            q += values[i].toLowerCase();//transform value int lowercase
                    first = 0;
            }
        }
        url += q;//create the url

        //  so you can set the parameters of the query
        if(InfoUrl.isFuzzy)
        {
         url += &quot;&amp;fuzzy=1&quot;;
        }
        else
        {
         url += &quot;&amp;fuzzy=0&quot;;
        }
        busy = true;
        self.scrollTo(0, 0);
        url += &quot;&amp;callback=?&quot;;
        $.getJSON(url, function(data) {
            if(!InfoShow.isDropDownList)
              display(data,InfoShow);//show the results directly
            else
             display_dropdown(data,InfoShow);//show the results using dropdownlist

            });
   }

}
//display json data
function display(response,InfoShow) {
        busy = false;
        var time = response.searcher_time;
        var data = response.results;
        html = &quot;Searcher Time: &quot;+time+&quot; ms&lt;br&gt;&quot;;
        html += &quot;&lt;hr&gt;&quot;;
        for(var i = 0; i &lt; data.length; i++) {
                var regex = prepareRegex(data[i].matching_prefix, data[i].edit_dist);
                if(data[i].record){
                        //so in here you can set different attributes in the record
                        //display the arrtributes that you give
                        for(var j=0;j&lt;InfoShow.attibuteArray.length;j++)
                        {
                            var attribute=InfoShow.attibuteArray[j];
                            if(data[i].record[attribute] != null)
                            {
                                html +=attribute;
                                html += highlight(&quot;: \&quot;&quot;+data[i].record[attribute]+&quot;\&quot;&quot;, regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;
                            }
                        }
                         //in here you can set css style:exact or fuzzy and
                        // set the color and size font in css file like
                        //&lt;style type=&quot;text/css&quot;&gt;
                        //  span.fuzzy {
                        //          color: #ff00ff;
                        //          font-weight: bold;
                        //  }
                        //  span.exact {
                        //          color: red;
                        //          font-weight: bold;
                        //  }&lt;/style&gt;
                        html += highlight(JSON.stringify(data[i].record), regex, &quot;exact&quot;, &quot;fuzzy&quot;);
                        html += &quot;&lt;br&gt;&quot;;
                        html += &quot;&lt;i&gt;Overall Score:&quot;+data[i].score+&quot;&lt;/i&gt;&lt;hr&gt;&quot;;
                }
                else{
                        html += &quot;Record Id: &quot;
                        html += highlight(data[i].record_id.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Score: &quot;
                        html += highlight(data[i].score.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Edit Distances: &quot;
                        html += highlight(data[i].edit_dist.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Matching Prefixes: &quot;
                        html += highlight(data[i].matching_prefix.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                }
                html += &quot;&lt;br&gt;&quot;;
        }

        document.getElementById(InfoShow.resultDivId).innerHTML=html;
        if(pending) {//for the next query,set the pending=false
                pending = false;
                query(document.getElementById('input').value);
        }

}

function display_dropdown(responseJSON,InfoShow) {
    busy = false;

    data = responseJSON.results;
    time = responseJSON.payload_access_time+ responseJSON.searcher_time;

    var html = &quot;&lt;div id='tbody' align='left'&gt;&quot;;
    for(var i = 0; i &lt; data.length; i++) {

            var regex = prepareRegex(data[i].matching_prefix, data[i].edit_dist);
            html += &quot;&lt;div &quot;+(i%2?&quot;class=item1&quot;:&quot;class='item2'&quot;)+&quot;&gt;&quot;;
            for(var j=0;j&lt;InfoShow.attibuteArray.length;j++)
            {
                var attribute=InfoShow.attibuteArray[j];
                html += &quot;&lt;div &quot;+(j%2?&quot;class=entry0&quot;:&quot;class='entry1'&quot;)+&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;;
                if(data[i].record[attribute] != null)
                    html += highlight(data[i].record[attribute].replace(/\uFFFD/gi,&quot; &quot;), regex, &quot;highlight1&quot;, &quot;highlight2&quot;);
                html += &quot;&lt;/div&gt;&quot;;
            }
            html += &quot;&lt;/div&gt;&quot;;
        }
    html+=&quot;&lt;div class='entry0'&gt;&lt;Font color='blue'&gt; Full Text search for \&quot;&quot;+document.getElementById(&quot;input&quot;).value+&quot;\&quot;&lt;/font&gt;&lt;/div&gt;&quot;;
    html += &quot;&lt;/div&gt;&lt;div class='static'&gt;&quot;        

    html += &quot;&lt;div style='width:60%;float:left;text-align:left;'&gt;&lt;font color='#333'&gt;(&lt;b&gt;&quot;+time+&quot;&lt;/b&gt; milliseconds) Results &lt;b&gt;&quot;
        +(page*m+1)+&quot;&lt;/b&gt; - &lt;b&gt;&quot;+(page*m+data.length)+&quot;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&quot;;

    html+=&quot;&lt;div style='width:40%;text-align:right;float:right;'&gt;&lt;a href = \&quot;http://www.srch2.com\&quot; style=\&quot;text-decoration:none\&quot;&gt; &lt;font color='#333'&gt;&amp;nbsp;&amp;nbsp;powered&amp;nbsp;by&amp;nbsp;&lt;/font&gt;&lt;font face=\&quot;Times New Roman\&quot; color=\&quot;#ff0000\&quot;&gt;SRCH2&lt;/font&gt;&lt;/a&gt;&lt;/div&gt;&quot;;
    html += &quot;&lt;/div&gt;&quot;;

    ac.clearItems();
        ac.list.innerHTML = html;
    ac.addItems(ac.list.childNodes[0]);
    ac.showList();
    if(pending) {
        pending = false;
        query();
    }
                           }
//prepare the Regex with edit-distance ed for matching prefix keys
function prepareRegex(keys, ed) {
    var regex1 = &quot;(&quot;;
    var regex2 = &quot;(&quot;;
    var j1 = 0;
    var j2 = 0;
    for(var k = 0; k &lt; keys.length; k++){
        if(keys[k].length){
            if(ed[k] == 0) { //if the edit-distance is 0
                if(j1)regex1 += &quot;|&quot;;
                regex1 += keys[k].replace(/\W/g, 
                    function(sub) {return &quot;\\&quot; + sub;});
                j1++; 
            }
            else {
                if(j2)regex2 += &quot;|&quot;;
                regex2 += keys[k].replace(/\W/g, 
                    function(sub) {return &quot;\\&quot; + sub;});
                j2++;
            }
        }
    }

    regex1 += &quot;)&quot;;
    regex2 += &quot;)&quot;;
    return [ (j1)?new RegExp(regex1, &quot;gi&quot;):null, (j2)?new RegExp(regex2, &quot;gi&quot;):null ];
}

//highlight the matching characters in string using css style: stylec1 or stylec2.
function highlight(string, regexp, stylec1, stylec2) {
    var str = &quot; &quot; + string.replace(/&lt;/g, &quot;&amp;lt;&quot;); 
    if(regexp == null)
        return str;
    if(regexp[0] != null)//for the edit-distance is 0
        str = str.replace(regexp[0], function(sub, m1, m2) {
            //m1  is the matching keyword, m2 is the positon of starting matching character
            var previousChar = str.charAt(m2-1);//get the previous char of starting matching char
            //check the previous char is null or is not English letter or number
            if(previousChar == null || previousChar.match(/^[a-zA-Z0-9_&amp;]+$/) == null)
               return &quot;&lt;span class='&quot; + stylec1 + &quot;'&gt;&quot; + m1 + &quot;&lt;/span&gt;&quot;;
            else return m1;
            });
    if(regexp[1] != null)//for the edit-distance is not 0
        str = str.replace(regexp[1], function(sub, m1, m2) {
            var previousChar = str.charAt(m2-1);
            if(previousChar == null || previousChar.match(/^[a-zA-Z0-9_&amp;]+$/) == null)
               return &quot;&lt;span class='&quot; + stylec2 + &quot;'&gt;&quot; + m1 + &quot;&lt;/span&gt;&quot;;
            else return m1;
        });
    return str.replace(/^\s+/, '');;
}

</code></pre>

<blockquote>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;You need to keep the “jquery-1.7.1.min.js” along with other files that are mentioned in previous steps. Jquery is a cross-browser JavaScript library designed to simplify the client-side scripting of HTML. To download the file, right click on <a href="./example-demo/jquery-1.7.1.min.js" style="text-decoration:none" target="_blank">jquery-1.7.1.min.js</a> and click on "Save Link as".</p>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Move index.html, srch2.js, jquery-1.7.1.min.js and apptest.wsgi into the Apache root directory such as “/var/www/test/”.</p>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Add the following lines to /etc/apache2/apache2.conf </p>
</blockquote>
<pre><code># load the mod_wsgi module. If you don't have it, you can put it the modules directory and load it
LoadModule wsgi_module /usr/lib/apache2/modules/mod_wsgi.so

#forward the request sent to doman.com/apptest the corresponding WSGI script
#WSGIScriptAlias /apptest /path/to/the/apptest.wsgi, For example:
WSGIScriptAlias /apptest /var/www/test/apptest.wsgi
</code></pre>

<blockquote>
<p><strong>Step 6:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Restart the Apache</p>
</blockquote>
<pre><code class="python">&gt; sudo /etc/init.d/apache2 restart
</code></pre>

<blockquote>
<p><strong>Step 7:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open your browser and put "http://localhost/test" to do the search and see the results. You should be able to see <a href="http://example.srch2.com" style="text-decoration:none" target="_blank">this</a> on your machine.</p>
</blockquote>
<p></br>
</br></p>
<h2 id="restfulapi">RESTful API</h2>
<p><div id="indexTable"><table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#880000" href="#doc">Contents</a></h3></div></p>
<p>&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#apisearch">API related to search</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#apiinsert"/>API related to insert/delete/update</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#apiserialize">API to serialize the index</a></br><br>
</td></tr></tbody></table></div></p>
<blockquote>
<p>The SRCH2 search engine provides a RESTful API, which can be used easily to do search queries, insert new documents, and delete existing documents.</p>
</blockquote>
<h3 id="apisearch">API related to search</h3>
<blockquote>
<p>A search query can be provided to find documents using the index. The search results contain document identifiers (provided at indexing time) and all their fields. </p>
</blockquote>
<h4>Search</h4>
<blockquote>
<p>This request sends a search query string that contains:</p>
<blockquote>
<ul>
<li>"q": the query to be performed. You may use "+" to concatenate multiple keywords.</li>
</ul>
</blockquote>
<p>Optionally:</p>
<blockquote>
<ul>
<li>"start": the first position to return (for pagination);</li>
<li>"limit": how many results to return (its default value is 10);</li>
<li>"fuzzy": 0 for exact search; 1 for fuzzy search.</li>
</ul>
</blockquote>
<p>If a query includes a "fuzzy=1" condition, the engine will do a fuzzy search automatically by using a normalized edit distance based on the length of the keyword. If the keyword length is in [0, 4], the edit distance threshold is 0; if the length is in [5, 7], the threshold is 1; if the length is more than 7, the threshold is 2.</p>
<p>If it is a geo index, the query should use one of the two ways below to define a geo region to search on:</p>
<blockquote>
<ol>
<li>
<p>Specify a bounding box:</p>
<blockquote>
<ul>
<li>"lb_lat": the latitude of the left bottom point of the bounding box;</li>
<li>"lb_lng": the longitude of the left bottom point of the bounding box;</li>
<li>"rt_lat": the latitude of the top right point of the bounding box;</li>
<li>"rt_lng": the longitude of the top right point of the bounding box.</li>
</ul>
</blockquote>
</li>
<li>
<p>Specify a center point and a radius:</p>
<blockquote>
<ul>
<li>"ct_lat": the latitude of the center point;</li>
<li>"ct_lng": the longitude of the center point;</li>
<li>"radius": the radius of the search range in degree.</li>
</ul>
</blockquote>
</li>
</ol>
</blockquote>
<p>The response body will contain a JSON map with the following fields:</p>
<ul>
<li>"payload_access_time": the time to generate the JSON results;</li>
<li>"query_keywords": the list of the keywords of this query;</li>
<li>"results": a list of result objects, where each result object has the following fields:<blockquote>
<ul>
<li>"edit_dist": the edit distance between the matching part of the result and the query;</li>
<li>"matching_prefix": the matching part of the result;</li>
<li>"record": the result record with the "id" field and other fields. You can use the two options "search-response-format" and "attributes-to-return" in the configuration file to specify which fields of the record you want the engine to return.</li>
<li>"score": a score of the result;</li>
</ul>
</blockquote>
</li>
<li>"results_found": the number of all the results found (GetAllResultsQuery and Geo Search only);</li>
<li>"searcher_time": the time (in milliseconds) it took to search;</li>
<li>"type": the type of search of this query: 0 for normal text only search; 1 for text only search to get all results; 2 for Geo search;</li>
<li>"fuzzy": indicating if the query is a fuzzy search: 0 for exact search; 1 for fuzzy search;</li>
<li>"offset": the offset point of the retrieved results in the whole results set;</li>
<li>"limit" : the number of the retrieved results;</li>
<li>"sortby": indicating which sortable attribute the results are sorted by (for GetAllResultsQuery only);</li>
<li>"order": indicating the ascending/descending order in which the results are sorted: 0 for an ascending order; 1 for a descending order (for GetAllResultsQuery only).</li>
</ul>
<p>Example for a "Keyword search" (Option 1) index (Notice that the engine can do fuzzy search to find matches similar to the mistyped keyword "hosptal"): </p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;start=0&amp;limit=20&amp;fuzzy=1&quot;
</code></pre>

<blockquote>
<p>Example for a "Keyword+Geo or Geo only" (Option 2) index:</p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;start=0&amp;limit=20&amp;fuzzy=1&amp;lb_lat=61.20&amp;lb_lng=-149.90&amp;rt_lat=61.22&amp;rt_lng=-149.70&quot;
</code></pre>

<blockquote>
<p>Example for a "Keyword+Geo or Geo only" (Option 2) index (Notice that the engine can search a range without keywords):</p>
</blockquote>
<pre><code>$ curl -i &quot;http://localhost:8081/search?start=0&amp;limit=20&amp;lb_lat=61.20&amp;lb_lng=-149.90&amp;rt_lat=61.22&amp;rt_lng=-149.70&quot;
</code></pre>

<blockquote>
<p>By default, the results will be ranked by the way described in sections 3 and 4, and you need to specify the number of results by "start" and "limit".
  To get all the results, you need to add a parameter "type" in the query url to let the engine do a different type of query. For this type of query, the engine will return all the results and sort them by the field of your choice. Please note that this type of query is not available for "Keyword+Geo" (Option 2) index.</p>
<p>In the configuration file, you need to set up options "attributes-sort", "attributes-sort-type", and "attributes-sort-default-value" to specify one or more fields that you would like to use to sort the results. For example, you want to use "id" or "relevance" to do the sorting. Then the three options will look like:</p>
<ul>
<li>attributes-sort=id,relevance</li>
<li>attributes-sort-type=0,1 (0 for unsigned, 1 for float)</li>
<li>attributes-sort-default-value=0,0.5 (default values for the attributes if they are missing in the record)</li>
</ul>
<p>In the query url, you need to specify the search type:</p>
<ul>
<li>"type": 0 for normal search; 1 for search to get all results. Its default value is 0.</li>
</ul>
<p>Optionally, you can also specify:</p>
<ul>
<li>"sortby": the offset of the attributes you listed in the option "attributes-sort" that you want to sort the results by. The default value is 0.</li>
<li>"order": 0 for ascending; 1 for descending. The default value is 0 (ascending).</li>
</ul>
<p>For example, with the configuration above, if you want to get all the results of a search and sort them by the "id" attribute in the ascending order (Notice that the engine can do fuzzy search to find matches similar to the mistyped keyword "hosptal"): </p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;fuzzy=1&amp;type=1&amp;sortby=0&amp;order=0&quot;
</code></pre>

<blockquote>
<p>If you want to get all results and sort them by "relevance" in descending order: </p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;fuzzy=1&amp;type=1&amp;sortby=1&amp;order=1&quot;
</code></pre>

<h4>Attribute-based Search</h4>
<blockquote>
<p>Starting from version 2.08, our engine can support attribute-based search, i.e., users can specify certain attributes where a keyword has to appear. To do that, you need to turn on the "support-attribute-based-search" option in the configuration file.</p>
<p>In the query url, you can separate attribute names and values by colon, and use comma (",") to represent the "AND" logic between attributes and dot (".") to represent the "OR" logic.</p>
<p>For instance, if the keyword "hosptal" needs to appear in the attribute "title" and the keyword "sevices" needs to appear in the attribute "description", we can use the following query: </p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/search?q=hosptal:title+sevices:description&amp;start=0&amp;limit=20&amp;fuzzy=1&quot;
</code></pre>

<blockquote>
<p>If the keyword "hosptal" needs to appear either in the attribute "title" or in the attribute "description": </p>
</blockquote>
<pre><code>$ curl -i &quot;http://localhost:8081/search?q=hosptal:title.description&amp;start=0&amp;limit=20&amp;fuzzy=1&quot;
</code></pre>

<blockquote>
<p>The dot in "hosptal:title.description" represents the "OR" condition. 
  If the keyword "hosptal" needs to appear in both attributes "title" and "description":</p>
</blockquote>
<pre><code>$ curl -i &quot;http://localhost:8081/search?q=hosptal:title,description&amp;start=0&amp;limit=20&amp;fuzzy=1&quot;
</code></pre>

<h3 id="apiinsert">API related to insert/delete/update</h3>
<blockquote>
<p>Documents can be inserted into and deleted from the index. A unique identifier must be provided for each document. This identifier will be used in the search results to reference the matching document. Every field defined in the indexed document will be searchable.</p>
<p>The engine has a background thread to periodically merge the inserted/deleted/updated documents into the index, based on parameters (time interval or number of requests) specified in the "config.ini" file.</p>
</blockquote>
<h4>Insert</h4>
<blockquote>
<p>This request adds a document to the index. The request body should contain a JSON object, which should meet the following requirements:</p>
<ul>
<li>The JSON object should include a document identifier (e.g., "id"), which should be a non-empty string no longer than 1024 bytes;</li>
<li>The JSON object should include searchable fields defined in the configuration file "config.ini" and their corresponding values;</li>
<li>If the engine is using a geo index, the JSON object should include a location specified by a latitude and a longitude.</li>
<li>The sum of the length of each field value cannot be greater than 100 kilobytes.</li>
</ul>
<p>Example for a "Keyword search" (Option 1) index: </p>
</blockquote>
<pre><code class="python">$ curl &quot;http://localhost:8081/docs&quot; -i -X PUT -d '{&quot;id&quot;:&quot;1234&quot;, &quot;name&quot;:&quot;Toy Story&quot;, &quot;category&quot;:&quot;shop&quot;}'
</code></pre>

<blockquote>
<p>Example for a "Keyword+Geo" (Option 2) index: </p>
</blockquote>
<pre><code class="python">$ curl &quot;http://localhost:8081/docs&quot; -i -X PUT -d '{&quot;id&quot;:&quot;1234&quot;, &quot;name&quot;:&quot;Toy Story&quot;, &quot;category&quot;:&quot;shop&quot;, &quot;lat&quot;: 43.22, &quot;lng&quot;: -80.22}'
</code></pre>

<h4>Delete</h4>
<blockquote>
<p>This request deletes a document from the index. It needs to provide the "id" of the document to be deleted.
  For clients that do not support body in DELETE requests, the "id" can be sent in the query string one time per document.</p>
<p>Example: </p>
</blockquote>
<pre><code class="python">$ curl &quot;http://localhost:8081/docs?id=1234&quot; -i -X DELETE
</code></pre>

<h4>Update</h4>
<blockquote>
<p>This request updates a document in the index. It needs to provide the "id" of the document to be updated. The request body should contain a JSON object, which should meet the following requirements:</p>
<ul>
<li>The JSON object should include a document identifier (e.g., "id"), which should be a non-empty string no longer than 1024 bytes;</li>
<li>The JSON object should include searchable fields defined in the configuration file "config.ini" and their corresponding values;</li>
<li>If the engine is using a geo index, the JSON object should include a location specified by a latitude and a longitude;</li>
<li>The sum of the length of each field value cannot be greater than 100 kilobytes;</li>
<li>The "id" in the query url needs to be consistent with the "id" in the JSON object.</li>
</ul>
<p>Example for a "Keyword search" (Option 1) index: </p>
</blockquote>
<pre><code class="python">$ curl &quot;http://localhost:8081/update?id=123&quot; -i -X PUT -d '{&quot;id&quot;:&quot;123&quot;,&quot;name&quot;:&quot;Brave&quot;, &quot;category&quot;:&quot;shop&quot;}'
</code></pre>

<blockquote>
<p>Example for a "Keyword+Geo" (Option 2) index:</p>
</blockquote>
<pre><code class="python">$ curl &quot;http://localhost:8081/update?id=123&quot; -i -X PUT -d '{&quot;id&quot;:&quot;123&quot;,&quot;name&quot;:&quot;Brave&quot;, &quot;category&quot;:&quot;shop&quot;, &quot;latitude&quot;: 43.22, &quot;longitude&quot;:
 -80.22}'
</code></pre>

<h3>API to retrieve system status information</h3>
<blockquote>
<p>This API returns information about the status of the system. </p>
</blockquote>
<h4>Info</h4>
<blockquote>
<ul>
<li>It returns the information about the system status. The response body will contain a JSON map with these fields:</li>
<li>"search_requests": number of queries received by the server so far;</li>
<li>"write_requests": number of insert/delete requests received by the server so far;</li>
<li>"docs_in_index": number of documents in the indexes;</li>
<li>"last_merge": last time (UTC time) the inserted/deleted documents are merged into the indexes;</li>
<li>"last_merge_time": the time spent to merge the inserted/deleted documents into the indexes;</li>
<li>"version": version of this engine.
  Example: </li>
</ul>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/info&quot;
</code></pre>

<h3 id="apiserialize">API to serialize the index</h3>
<blockquote>
<p>This API serializes the index to the disk. </p>
</blockquote>
<h4>Save</h4>
<blockquote>
<p>It saves the index with all the changes that have been made so far to the path on the disk specified by the option "index-dir-path" in the configuration file. So when the engine is restarted with the option "index-load-or-create" set to 1 in the configuration file, it can be brought back to the state right before it was shut down last time. </p>
<p>Example: </p>
</blockquote>
<pre><code class="python">$ curl -i &quot;http://localhost:8081/save&quot; -X PUT
</code></pre>

<h2 id="geo">Geo Search</h2>
<blockquote>
<p>The engine can be optionally configured to support geo index. So you have two options:</p>
<ul>
<li>
<p>Keyword Search (option 1)</p>
</li>
<li>
<p>Keyword + Geo OR Geo only (option 2)</p>
</li>
</ul>
<p><em>Trade-offs:</em> Keyword search (Option 1) alone is very powerful, and analogous to many widely-used full-text search solutions. It is very fast. Keyword+Geo (Option 2) offers a new hybrid indexing approach. You need to pick one option at the start, because SRCH2 will index your data differently depending on your choice (For Keyword+Geo, the lat and lng need to be a float type in the json objects in the data file. See the sample-data.json in the package for an example). To get more information about Geo search, go to the end of this documentation. </p>
<p>If it is a geo index, the query should use one of the two ways below to define a geo region to search on:</p>
<blockquote>
<p>1-  Specify a bounding box:</p>
<blockquote>
<ul>
<li>
<p>"lb_lat": the latitude of the left bottom point of the bounding box;</p>
</li>
<li>
<p>"lb_lng": the longitude of the left bottom point of the bounding box;</p>
</li>
<li>
<p>"rt_lat": the latitude of the top right point of the bounding box;</p>
</li>
<li>
<p>"rt_lng": the longitude of the top right point of the bounding box.</p>
</li>
</ul>
</blockquote>
<p>2-  Specify a center point and a radius:</p>
<blockquote>
<ul>
<li>
<p>"ct_lat": the latitude of the center point;</p>
</li>
<li>
<p>"ct_lng": the longitude of the center point;</p>
</li>
<li>
<p>"radius": the radius of the search range in degree.</p>
</li>
</ul>
</blockquote>
</blockquote>
<p><strong>[important]</strong> To do a Geo Search, for each of the objects you should have latitude/longitude attribute to let the engine do the Geo search. In conf.ini file of the SRCH2 engine, to do a Geo search, you need to set the following attributes:</p>
<blockquote>
<ul>
<li>attribute-latitude=lat</li>
<li>attribute-longitude=lng</li>
</ul>
</blockquote>
<p><strong>[important]</strong> If the engine is using a geo index, the JSON object should include a location specified by a latitude and a longitude. <br>
</p>
<blockquote>
<ul>
<li>for example:<blockquote>
<ul>
<li>{"id":"1234", "name":"Toy Story", "category":"shop", "lat": 43.22, "lng": -80.22}</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>Example for a "Keyword+Geo or Geo only" (Option 2) index:</p>
</blockquote>
<pre><code>$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;start=0&amp;limit=20&amp;fuzzy=1&amp;lb_lat=61.20&amp;lb_lng=-149.90&amp;rt_lat=61.22&amp;rt_lng=-149.70&quot;
</code></pre>

<h2 id="ranking">Ranking</h2>
<blockquote>
<p>Intuitively, for a query and a candidate record (document), we compute the score of each term in the query for the record, and take the summation of these scores as the overall score. We order the records based on their overall score. The engine guarantees that exact results are always ranked higher than fuzzy results. </p>
<p>Formally, let Q be a query with terms (keywords) t_1, t_2, ..., t_k. Let r be a record. We compute the score of r for Q as follows: </p>
<ul>
<li>score(r, Q) = TermScore(r, t_1) + TermScore(r, t_2) + ... + TermScore(r, t_k).</li>
</ul>
<p>For each term t_i, let w_i be a keyword in r that matches t_i (exactly or fuzzily). The TermScore(r, t_i) is computed as follows: </p>
<p>TermScore(r, t_i) = TermRecordStaticScore(r, t_i) * NormalizedEdSimilarity(w_i, t_i) * PrefixMatchingNormalizer.</p>
<p>where</p>
<ul>
<li>NormalizedEdSimilarity(w_i, t_i): </li>
</ul>
<blockquote>
<p>NormalizedEdSimilarity(w_i, t_i) = 1 - EditDistance(w_i, t_i)/length(t_i). 
 The upper bound of EditDistance(w_i, t_i) is length(t_i).</p>
</blockquote>
<ul>
<li>PrefixMatchingNormalizer: </li>
</ul>
<blockquote>
<p>It is 1 if term t_i is a complete keyword. If term t_i is a prefix, then PrefixMatchingNormalizer takes the value of the parameter "prefix-match-penalty" specified in the configuration file.</p>
</blockquote>
<ul>
<li>TermRecordStaticScore(r, t_i): </li>
</ul>
<blockquote>
<p>It is the static score of this term for this record, which is computed and stored during index construction. It uses an expression customizable in the configuration file. The expression can use the following parameters: </p>
<ul>
<li>idf_score: internal IDF score;</li>
<li>doc_boost: the boost value of the record as specified in an attribute;</li>
<li>doc_length: number of unique keywords in the record.
 The expression allows operators such as +, -, /, *, (, ), 0-9, etc. </li>
</ul>
<p>The "idf_score" uses the following formula:</p>
<ul>
<li>idf_score(r, t_i) = (1.0 + sumOfFieldBoosts(r, t_i) / sumOfAllFieldBoosts ) * idf(t_i);</li>
</ul>
<p>sumOfFieldBoosts(r, t_i) is the summation of the boosts of the attributes in which this keyword t_i appears in r, and sumOfAllFieldBoosts is the summation of the boosts of all the searchable attributes. Therefore, we can assign higher boosts to attributes to increase their weights in the ranking. </p>
<p>idf(t_i) is the inversed document frequency:</p>
<ul>
<li>idf(t_i) = log_e (total # of documents/ # of documents having term t_i).</li>
</ul>
<p>In the case where the record r has multiple keywords w_i's that match term t_i, TermScore(r, t_i) is the largest value among them.</p>
</blockquote>
</blockquote>
<p></td></tr></table>
</font></body></p>
<style type="text/css">
pre{
    margin: auto;
    width:80%;
    display: block;
    padding: 9.5px;
    font-size: 13px;
    line-height: 20px;
    word-break: break-all;
    word-wrap: break-word;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    overflow:auto;
    max-height:600px;
}
#content{
    position:fixed;
    left:10px;
    top:20px;
    padding: 5.5px;
    font-size: 13px;
    //line-height: 20px;
    word-break: break-all;
    word-wrap: break-word;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    text-align:center;
}
html{
    min-width:1100px;
}
#indexTable{
    padding: 5.5px;
    font-size: 13px;
    //line-height: 20px;
    word-break: break-all;
    word-wrap: break-word;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    text-align:center;
    display: inline-block
}
#bigBox{
    padding: 10px;
    font-size: 13px;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    //text-align:center;
    display: inline-block
}

</style>
</body>
</html>
