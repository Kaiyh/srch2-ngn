<html>
<head>
	<title>Bimaple Search UI</title>

	<link href="static/bootstrap/css/bootstrap.css" rel="stylesheet">
	<style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      #search-server-dropdown {
      	padding-top: 5px;
      }
  </style>
</head>
<body>



    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
        	<a class="brand" href="#">Bimaple Search</a>

        	<div class="control-group" id='search-server-dropdown'>
            <div class="controls">
              <select id="search-server-select">
                <option value="http://localhost:8081">8081</option>
                <option value="http://localhost:8082">8082</option>
                <option value="http://50.56.33.28:8085">8085 (words index)</option>
              </select>
            </div>
          </div>

        </div>
      </div>
    </div>


	<div class="container-fluid">

		<div class="row-fluid">
			<div class="span9">

				<form class="well">
				  <label>Enter search query</label>
				  <input type="text" id='search-bar' class="span6" placeholder="Start typing...">

				  <label>Enter limit</label>
				  <input type="text" id='limit-bar' class="span3" value='10' placeholder="10">
				</form>

			</div>
		</div>


		<div class="row-fluid">
			<div class="span0">
			</div>

			<div class="span9" id='search-results'>

			</div>
		</div>

	</div>  <!-- container-fluid -->

	<script type="text/javascript" src='static/jquery/jquery.min.js'></script>
	<script type="text/javascript" src='static/bootstrap/js/bootstrap.js'></script>

	<script>
		var old_timestamp = 0;
		var search_text = '';
		var limit_val = $('#limit-bar').val();
		var delay = 1000;
		var server_url = $("#search-server-select").val();
		var full_url = '';

		function call_bimaple() {
			search_text = $('#search-bar').val();
			server_url = $("#search-server-select").val();
			limit_val = $('#limit-bar').val();
			limit_int = parseInt(limit_val);

			if (search_text.length >= 2 && limit_int > 0) {

				search_text = search_text.replace(' ', '+');
				//console.log(server_url);
				//console.log(search_text);

				full_url = server_url + '/search?q=' + search_text + '&limit=' + limit_val + '&callback=?&fuzzy=1';

				$.getJSON(full_url, function(data) {
					var results = [];
					$('#search-results').html('');

					$.each(data.results, function(k, oval) {
						var items = [];
						var res_title = oval.record.title;
                        var score = oval.score;
						$.each(oval.record, function(key, val) {
							items.push('<li id="' + key + '">' + key + ': ' + val + '</li>');
						});
						results.push('<p><h4>' + res_title + ' - ' + score + '</h4><ul>' + items.join(' ') + '</ul></p>');
					});

					$('#search-results').html(results.join(' '));
				});
			}
		}

		$('#search-bar').keyup(function(event) {
			call_bimaple();
		});


		$('#limit-bar').keyup(function(event) {
			call_bimaple();
		});

	</script>
<!--
	<script>
		$.getJSON('ajax/test.json', function(data) {
		  var items = [];

		  $.each(data, function(key, val) {
		    items.push('<li id="' + key + '">' + val + '</li>');
		  });

		  $('<ul/>', {
		    'class': 'my-new-list',
		    html: items.join('')
		  }).appendTo('body');
		});
	</script>
-->

</body>
</html>
