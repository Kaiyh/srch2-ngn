<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
</head>
<body>
<p><link rel="stylesheet" href="highlight/styles/default.css">
<script src="highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="shortcut icon" href="tab_icon.png" ></p>
<table><tr>

<td style="width:14%"> 
<div id="content">
<table><tbody><tr><td>
<div><h3><a style="text-decoration: none;color:#880000" href="#doc">Documentation</a></h3></div>

&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#intro">Introduction</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#serverConfig"/>Configure and<br>&nbsp;&nbsp;&nbsp;Run the Server</a><br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#wsgi">Install Apache<br>&nbsp;&nbsp;&nbsp;and mod_wsgi</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#UI">Design a Simple<br>&nbsp;&nbsp;&nbsp;User Interface</a></br><br>
&nbsp;&nbsp;&nbsp;<a style="text-decoration: none;color:#3366FF" href="#geo">Geo Search </a></br><br>

</td></tr></tbody></table>

<p><span ><a  href="http://www.srch2.com" target="_blankt"><img  style="width:100px" src="./logo.png" /></a></span></br></br>
</div></p>
<p></td>
<td style="width:86%"></p>
<h1 id="doc" style="color:#880000">SRCH2 Engine Documentation</h1>
<h2 id="intro">Introduction</h2>
<blockquote>
<p>This project illustrates how to set up a simple SRCH2 implementation. We’ll take you through all the basic steps required to download SRCH2, index your database in standard JSON format, configure search features, and run your search server. SRCH2 runs on a Linux Ubuntu server. Please keep in mind that SRCH2 is designed to be highly configurable, so while this will get you started, we hope you tune it to your specific needs and use cases. An online demo based on these instructions is available at <a href="http://example.srch2.com" style="text-decoration:none;" target="_blank">http://example.srch2.com</a>. Enjoy!
</br></p>
</blockquote>
<h2 id="serverConfig">Configure and Run the Search Server</h2>
<blockquote>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Download the SRCH2 Engine from <a href="http://www.srch2.com/files/srch2-engine-v3.0.tgz" style="text-decoration:none">here</a>. Then extract it and put all of the files where you want to have the engine. There are four files there as below:</p>
<ul>
<li><em>srch2-engine</em> (Binary file of the engine)</li>
<li><em>conf.ini</em> (The configuration file)</li>
<li><em>readme.txt</em> </li>
<li><em>sample-data.json</em> (It is a sample data having <a href="http://www.json.org/" style="text-decoration:none" target="_blank">JSON</a> format to test the engine with)</li>
</ul>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Obtain a license key from SRCH2 by emailing <em>contact (at) srch2 (dot) com</em>. SRCH2 will send you a temporary license key file which has an expiration date. Store the key file locally, such as <em>“srch2_license_key.txt”</em>.</p>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open the <em>conf.ini</em> file that you downloaded  and set the <em>“license-file”</em> option to the path of the key, such as</p>
</blockquote>
<pre><code class="python">license-file=/path/to/the/srch2_license_key.txt
</code></pre>

<blockquote>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open the <em>conf.ini</em> file and set the <em>“data-file-path”</em> option to the path of the data. For this example it is already set, you can find it like</p>
</blockquote>
<pre><code class="python">data-file-path=sample-data.json
</code></pre>

<blockquote>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;(Optional) The engine can be optionally configured to supprot geo index. So you have two options:</p>
<ul>
<li>
<p>Keyword Search (option 1)</p>
</li>
<li>
<p>Keyword + Geo OR Geo only (option 2)</p>
</li>
</ul>
<p><em>Trade-offs:</em> Keyword search (Option 1) alone is very powerful, and analogous to many widely-used full-text search solutions. It is very fast. Keyword+Geo (Option 2) offers a new hybrid indexing approach. You need to pick one option at the start, because SRCH2 will index your data differently depending on your choice (For Keyword+Geo, the lat and lng need to be a float type in the json objects in the data file. See the sample-data.json in the package for an example). To get more information about Geo search, go to the end of this documentation. </p>
<p><strong>Step 6:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Now it is time to run the engine. Open a terminal and go to the directory of the engine that you have already downloaded</p>
</blockquote>
<pre><code class="python">&gt; cd path/to/the/engine/directory
</code></pre>

<blockquote>
<p>Run the engine now.</p>
</blockquote>
<pre><code class="python">&gt; ./srch2-engine --config-file=conf.ini
</code></pre>

<blockquote>
<p><em>conf.ini</em> is the config file and here we are passing it to the engine. Wait until the engine finishes the index construction and is ready to serve queries. </p>
<p>You should see 
<center>
  <img alt="Enine is running" src="./engine_running.png">
</center></p>
<p><strong>Step 7:</strong>&nbsp;&nbsp;&nbsp;&nbsp;(Optional) If you don't have <em>curl</em> installed on your machine, you need to install it to test the engine through terminal</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install curl
</code></pre>

<blockquote>
<p><strong>Step 8:</strong>&nbsp;&nbsp;&nbsp;&nbsp;To test the engine, open a new terminal use the following command. For example you want to search for the keyword <em>“properties”</em> you should write</p>
</blockquote>
<pre><code class="python">&gt; curl -i  http://localhost:8081/search?q=properties
</code></pre>

<blockquote>
<p>This query is doing a search for a "keyword search" index. Now you should see the results as following</p>
</blockquote>
<p><center></p>
<blockquote>
<p><img alt="Enine is running" src="./results.png">
</center>
</br></p>
</blockquote>
<h2 id="wsgi">Install Apache and mod_wsgi</h2>
<blockquote>
<p>This section shows how to install apache and the mod_wsgi on Ubuntu and CentOs. If you have already installed the Apache and mod_wsgi on your machine, you can skip this part. </p>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install Apache2</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install apache2
</code></pre>

<blockquote>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install the mod_wsgi</p>
</blockquote>
<pre><code class="python">&gt; sudo aptitude install libapache2-mod-wsgi
</code></pre>

<blockquote>
<p>WSGI is a Web Server Gateway Interface and is for communications between web servers and web applications for Python programming language.</p>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;<em>mod_wsgi</em> needs to have python installed on your machine. If you don't have python, install it using the following command, else skip this step.</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install python
</code></pre>

<blockquote>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Install simplejson python package, which is an extensible JSON encoder and decoder</p>
</blockquote>
<pre><code class="python">&gt; sudo apt-get install python-setuptools
</code></pre>

<pre><code class="python">&gt; sudo easy_install simplejson
</code></pre>

<blockquote>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;So far you have installed Apache, mod_wsgi and python. A WSGI script will forward the request from Apache to the SRCH2 engine, which is running on the same machine, and will get the search results and sends them back. For more information about wsgi, read the appendix 1 at the end of this page. A simple WSGI script is as following</p>
</blockquote>
<pre><code>import cgi
import simplejson
import urllib2

def application(environ, start_response):

        #Parse the request
        d = cgi.parse_qs(environ['QUERY_STRING'])
        query = d.get('q', [''])[0]
        callback = d.get('callback', [''])[0]
        query = &quot;+&quot;.join(query.split(&quot; &quot;))

        #Forward the request to the engine and get the results
        query_url = &quot;http://127.0.0.1:8081/search?q=&quot; + query + &quot;&amp;fuzzy=1&quot;
        request = urllib2.Request(query_url)
        resp = urllib2.urlopen(request).read()

        #Configure response content and wrap the output into the &quot;callback&quot;
        status = '200 OK'

        output = callback+'('+resp+');'
        response_headers = [('Content-type', 'text/plain'),
                        ('Content-Length', str(len(output)))]
        start_response(status, response_headers)
        return [output]
</code></pre>

<blockquote>
<p>This script makes the query and sends it to the engine. You can see the query in "query_url" variable. If you want to do a fuzzy search, you should keep "&amp;fuzzy=1" and if you don't want to do it, you should remove the part "+ &amp;fuzzy=1" from the end of query_url</p>
</blockquote>
<h2 id="UI">Design a Simple User Interface</h2>
<blockquote>
<p>This part will show how to design a simple user interface and connect it to the engine. The overall process is first, you need to have a html page that has an input box for the search keywords. Then you have to send the query to the search engine using Ajax. Then you have to get the respond and show the results. </p>
<p><strong>Step 1:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Design a html page for searching and then connect it to your engine. The simpleset way is to have a <em>input box</em> to write the keywords in it. Here is a simple html page. To dwonload this file, right click on <a href="./download/index.html" style="text-decoration:none" target="_blank">index.html</a> and click on "Save Link as".</p>
</blockquote>
<pre><code>&lt;!--DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;--&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;SRCH2&lt;/title&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;index.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;jquery-1.7.1.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;document.getElementById('input').focus();&quot;&gt;
&lt;center&gt;&lt;div&gt;&lt;h1&gt;SRCH2 Engine&lt;/h1&gt;&lt;/div&gt;
&lt;div&gt;&lt;table&gt;
        &lt;tr &gt;
                &lt;td colspan=3&gt;
                        &lt;input type='text' style=&quot;height:40px; width:800px; font-size:25px;&quot; class='inputTextfield' autocomplete='off' id='input' onkeyup='check(this.value)'&gt;
                &lt;/td&gt;
        &lt;/tr&gt;
&lt;/table&gt;&lt;/div&gt;
&lt;/center&gt;&lt;div id='results'&gt;&lt;/div&gt;&lt;hr&gt;
&lt;center&gt;Powered by SRCH2&lt;/center&gt;
&lt;style type=&quot;text/css&quot;&gt;
span.fuzzy {
        color: #ff00ff;
        font-weight: bold;
}
span.exact {
        color: red;
        font-weight: bold;
}&lt;/style&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>

<blockquote>
<p>Notes:</p>
<blockquote>
<ol>
<li>When someone types in the input box, it calls a JavaScript function called <code>check()</code>, which gets the search keywords and calls other functions to do the Ajax and show the results. To check it look at "onkeyup='check(this.value)'" inside the code. 'this.value' is the search keyword that are typed so far.</li>
</ol>
</blockquote>
<p><strong>Step 2:</strong>&nbsp;&nbsp;&nbsp;&nbsp;“index.js” has a function named <code>check()</code> which will be called whenever you type a character to search. Then it calls another function named <code>query()</code> to construct the query and uses Ajax to send it to the server. Then it shows the results by calling a function named <code>display()</code>. There are some other functions that are used by the mentioned functions and For more details about this functions, read the comments provided in the code. To dwonload this file, right click on <a href="./download/index.js" style="text-decoration:none" target="_blank">index.js</a> and click on "Save Link as".</p>
</blockquote>
<pre><code>var pending = false;
var old_q = &quot;&quot;;
var old_page = 0;
var busy=false;

function check(value) {
        var regex=/\+|\s/gi;
        if (value.length==0)
        {
                busy = false;
                document.getElementById('results').innerHTML=&quot;&quot;;
        }
        else if(value.replace(regex,&quot;&quot;).length &gt;= 3){
                if(busy)pending = true;
                else query(value);
        }
}

function query(value) {
        var regex=/\+/gi;
        value = value.replace(regex,&quot;&quot;);
        value = value.replace(/ +(?= )/g,'');
        var valuestmp = value.split(' ');
        var values = valuestmp;
        for (var i = 0; i &lt; valuestmp.length; i++ )
        {
                if (valuestmp[i]==&quot;&quot;)
                values.splice(i,i+1);
        }
        var url = &quot;http://localhost/apptest?q=&quot;;
        var first = 1;
        var q = &quot;&quot;;
        for(var i = 0; i &lt; values.length; i++) {
                if(values[i]!=''){
                if(!first)q += &quot;+&quot;;
                q += values[i].toLowerCase();
                        first = 0;
                }
        }
        url += q;
        // if any option's value changes
        if( q != old_q  ){
                url += &quot;&amp;fuzzy=1&quot;;
                busy = true;
                self.scrollTo(0, 0);
                url += &quot;&amp;callback=?&quot;;
                $.getJSON(url,
                  function (data) {
                    display(data);
                  });
                old_q = q;
        }

}

function display(response) {
        busy = false;
        var time = response.searcher_time;
        var data = response.results;
        html = &quot;Searcher Time: &quot;+time+&quot; ms&lt;br&gt;&quot;;
        html += &quot;&lt;hr&gt;&quot;;
        for(var i = 0; i &lt; data.length; i++) {
                var regex = prepareRegex(data[i].matching_prefix, data[i].edit_dist);
                if(data[i].record){
                        html += highlight(&quot;\&quot;&quot;+data[i].record.name+&quot;\&quot;&quot;, regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += highlight(JSON.stringify(data[i].record), regex, &quot;exact&quot;, &quot;fuzzy&quot;);
                        html += &quot;&lt;br&gt;&quot;;
                        html += &quot;&lt;i&gt;Overall Score:&quot;+data[i].score+&quot;&lt;/i&gt;&lt;hr&gt;&quot;;
                }
                else{
                        html += &quot;Record Id: &quot;
                        html += highlight(data[i].record_id.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Score: &quot;
                        html += highlight(data[i].score.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Edit Distances: &quot;
                        html += highlight(data[i].edit_dist.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                        html += &quot;Matching Prefixes: &quot;
                        html += highlight(data[i].matching_prefix.toString(), regex, &quot;exact&quot;, &quot;fuzzy&quot;)+&quot;&lt;br&gt;&quot;;
                }
                html += &quot;&lt;br&gt;&quot;;
        }

        document.getElementById('results').innerHTML=html;
        if(pending) {
                pending = false;
                query(document.getElementById('input').value);
        }

}

function prepareRegex(keys, ed) {
        var regex1 = &quot;([^A-Za-z0-9_&amp;])(&quot;;
        var regex2 = &quot;([^A-Za-z0-9_&amp;])(&quot;;
        var j1 = 0;
        var j2 = 0;
        for(var k = 0; k &lt; keys.length; k++)
        if(keys[k].length)
                if(ed[k] == 0) {
                if(j1)regex1 += &quot;|&quot;;
                regex1 += keys[k].replace(/\W/g, 
                    function(sub){return &quot;\\&quot; + sub;});
                j1++;
                }
                else {
                if(j2)regex2 += &quot;|&quot;;
                regex2 += keys[k].replace(/\W/g, 
                    function(sub){return &quot;\\&quot; + sub;});
                j2++;
                }
        regex1 += &quot;)&quot;;
        regex2 += &quot;)&quot;;
        return [ (j1)?new RegExp(regex1, &quot;gi&quot;):null, (j2)?new RegExp(regex2, &quot;gi&quot;):null ];
}

function highlight(string, regexp, stylec1, stylec2) {
        var str = &quot; &quot; + string.replace(/&lt;/g, &quot;&amp;lt;&quot;);
        if(regexp == null)
                return str;
        if(regexp[0] != null)
                str = str.replace(regexp[0], function(sub, m1, m2) {
                        return m1 + &quot;&lt;span class='&quot; + stylec1 + &quot;'&gt;&quot; + m2 + &quot;&lt;/span&gt;&quot;;
                    });
        if(regexp[1] != null)
            str = str.replace(regexp[1], function(sub, m1, m2) {
            return m1 + &quot;&lt;span class='&quot; + stylec2 + &quot;'&gt;&quot; + m2 + &quot;&lt;/span&gt;&quot;;
        });
        return str.replace(/^\s+/, '');;
}

</code></pre>

<blockquote>
<p><strong>Step 3:</strong>&nbsp;&nbsp;&nbsp;&nbsp;You need to keep the “jquery-1.7.1.min.js” along with other files that are mentioned in previous steps. Jquery is a cross-browser JavaScript library designed to simplify the client-side scripting of HTML. To download the file, right click on <a href="./download/jquery-1.7.1.min.js" style="text-decoration:none" target="_blank">jquery-1.7.1.min.js</a> and click on "Save Link as".</p>
<p><strong>Step 4:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Move index.html, index.js, jquery-1.7.1.min.js and apptest.wsgi into the Apache root directory such as “/var/www/test/”.</p>
<p><strong>Step 5:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Add the following lines to /etc/apache2/apache2.conf </p>
</blockquote>
<pre><code># load the mod_wsgi modue. If you don't have it, you can put it the modules directory and load it
LoadModule wsgi_module /usr/lib/apache2/modules/mod_wsgi.so

#forward the request sent to doman.com/apptest the corresponding WSGI script
#WSGIScriptAlias /apptest /path/to/the/apptest.wsgi, For example:
WSGIScriptAlias /apptest /var/www/test/apptest.wsgi
</code></pre>

<blockquote>
<p><strong>Step 6:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Restart the Apache</p>
</blockquote>
<pre><code class="python">&gt; sudo /etc/init.d/apache2 restart
</code></pre>

<blockquote>
<p><strong>Step 7:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Open your browser and put "http://localhost/test" to do the search and see the results. You should be abale to see <a href="http://example.srch2.com" style="text-decoration:none" target="_blank">this</a> on your machine.</p>
</blockquote>
<p></br>
</br></p>
<h2 id="geo">Geo Search</h2>
<blockquote>
<p>The engine can be optionally configured to supprot geo index. So you have two options:</p>
<ul>
<li>
<p>Keyword Search (option 1)</p>
</li>
<li>
<p>Keyword + Geo OR Geo only (option 2)</p>
</li>
</ul>
<p><em>Trade-offs:</em> Keyword search (Option 1) alone is very powerful, and analogous to many widely-used full-text search solutions. It is very fast. Keyword+Geo (Option 2) offers a new hybrid indexing approach. You need to pick one option at the start, because SRCH2 will index your data differently depending on your choice (For Keyword+Geo, the lat and lng need to be a float type in the json objects in the data file. See the sample-data.json in the package for an example). To get more information about Geo search, go to the end of this documentation. </p>
<p>If it is a geo index, the query should use one of the two ways below to define a geo region to search on:</p>
<blockquote>
<p>1-  Specify a bounding box:</p>
<blockquote>
<ul>
<li>
<p>"lb_lat": the latitude of the left bottom point of the bounding box;</p>
</li>
<li>
<p>"lb_lng": the longitude of the left bottom point of the bounding box;</p>
</li>
<li>
<p>"rt_lat": the latitude of the top right point of the bounding box;</p>
</li>
<li>
<p>"rt_lng": the longitude of the top right point of the bounding box.</p>
</li>
</ul>
</blockquote>
<p>2-  Specify a center point and a radius:</p>
<blockquote>
<ul>
<li>
<p>"ct_lat": the latitude of the center point;</p>
</li>
<li>
<p>"ct_lng": the longitude of the center point;</p>
</li>
<li>
<p>"radius": the radius of the search range in degree.</p>
</li>
</ul>
</blockquote>
</blockquote>
<p><strong>[important]</strong> To do a Geo Search, for each of the objects you should have latitude/longitude attribute to let the engine do the Geo search. In conf.ini file of the SRCH2 engine, to do a Geo search, you need to set the following attributes:</p>
<blockquote>
<ul>
<li>attribute-latitude=lat</li>
<li>attribute-longitude=lng</li>
</ul>
</blockquote>
<p><strong>[important]</strong> If the engine is using a geo index, the JSON object should include a location specified by a latitude and a longitude. <br>
</p>
<blockquote>
<ul>
<li>for example:<blockquote>
<ul>
<li>{"id":"1234", "name":"Toy Story", "category":"shop", "lat": 43.22, "lng": -80.22}</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>Example for a "Keyword+Geo or Geo only" (Option 2) index:</p>
</blockquote>
<pre><code>$ curl -i &quot;http://localhost:8081/search?q=hosptal+sevices&amp;start=0&amp;limit=20&amp;fuzzy=1&amp;lb_lat=61.20&amp;lb_lng=-149.90&amp;rt_lat=61.22&amp;rt_lng=-149.70&quot;
</code></pre>

<p></td></tr></table></p>
<style type="text/css">
pre{
    margin: auto;
    width:80%;
    display: block;
    padding: 9.5px;
    font-size: 13px;
    line-height: 20px;
    word-break: break-all;
    word-wrap: break-word;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    overflow:auto;
    max-height:600px;
}
#content{
    position:fixed;
    left:10px;
    top:20px;
    padding: 5.5px;
    font-size: 13px;
    //line-height: 20px;
    word-break: break-all;
    word-wrap: break-word;
    white-space: pre;
    white-space: pre-wrap;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    text-align:center;
}
html{
    min-width:1100px;
}
</style>
</body>
</html>
